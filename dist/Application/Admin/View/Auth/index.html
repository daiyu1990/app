<include file="Public:header"/>
    <!-- begin #content -->
    <div id="content" class="content">
      <!-- begin page-header -->
      <h1 class="page-header">{$title}</h1>
      <!-- end page-header -->
      
      <!-- begin row -->
      <div class="row">
          <!-- begin col-12 -->
          <div class="col-md-12">
              <!-- begin panel -->
                    <div class="panel panel-inverse">
                        <div class="panel-body">
                                <div class="row manage-search">
                                  <div class="col-md-6 btnArea">
                                    {:create_Url('Admin/Auth/add','+ 添加菜单',null,'class="btn btn-danger m-b-10 addMenu"')}
                                    {:create_Url('Admin/Auth/scan','更新菜单',null,'class="btn btn-info m-l-10 m-b-10"')}
                                  </div>
                                  <div class="col-md-6 form-group" id='manage-right'></div>
                                </div>
                                <table id="data-table" class="table table-striped table-bordered">
                                    <thead>
                                        <th>排序</th>
                                        <th>ID</th>
                                        <th>菜单标题</th>
                                        <th>菜单规则</th>
                                        <th>显示／隐藏</th>
                                        <th>管理操作</th>
                                    </thead>
                                    
                                </table>
                        </div>
                    </div>
                    <!-- end panel -->
                </div>
                <!-- end col-12 -->
            </div>
            <!-- end row -->
    </div>
    <!-- end #content -->
    <js file="__PUBLIC__/assets/js/treeTable/treeTable.js"/>
    <css file="__PUBLIC__/assets/js/treeTable/treeTable.css"/>
    <script>
    var Page = {
        init: function(){
            this.bind();
            this.renderTable();
        },
        bind: function(){
            var _this = this;
            $(document).on('click','.del',function(){
                var href = $(this).attr('href');
                var text = $(this).text();
                layer.confirm('确定'+text+'？', {
                    btn: ['确定','取消'] //按钮
                }, function(){
                    $.ajax({
                        url : href,
                        dataType:'json',
                        success: function(e){
                            // _this.renderTable();
                            if(e.state==0)
                            {
                              layer.alert(e.msg);
                              return false;
                            }
                            _this.renderTable();
                        }
                    })
                }, function(){
                    // 取消
                });
                return false;
            })
            $(document).on('click','.addMenu',function(){
              var that = $(this);
              $.ajax({
                url : that.attr('href'),
                success:function(result){
                  _this.openLayer(that.text(),result,'800px','600px');
                }
              })
              return false;
            })
            $(document).on('change','.coledit',function(){
                var that = $(this);
                var val = that.val();
                $.ajax({
                    url:"{:U('Auth/index',array('do'=>'up'))}",
                    data:{id:that.attr('target'),col:that.attr('col'),val:val},
                    dataType:'json',
                    success:function(){

                    }
                })
            })

            $(document).on('click','.qh',function(){
                var that = $(this);
                var val = that.attr('val');
                $.ajax({
                    url:"{:U('Auth/index',array('do'=>'up'))}",
                    data:{id:that.attr('target'),col:that.attr('col'),val:val},
                    dataType:'json',
                    success:function(){
                        if(val == 1){
                            that.text('隐藏');
                            that.attr('val',0);
                        } else {
                            that.text('显示');
                            that.attr('val',1);
                        }
                    }
                })
                return false;
            })
        },
        openLayer: function(title,html,width,height){
            if(width == ''){
                width = '1000px';
            }
            if(height == ''){
                height = '650px';
            }
            layer.open({
                type: 1,
                title: title,
                area: [width, height], //宽高
                closeBtn: 1, //不显示关闭按钮
                shift: 2,
                shadeClose: true, //开启遮罩关闭
                content: html
            });
        },
        renderTable: function(){
            layer.load(1, {
                shade: [0.1,'#fff'] //0.1透明度的白色背景
            });
            var _this = this;
            $.ajax({
                url:'{:U('Auth/index',array('do'=>'listTableData'))}',
                // data:{pid:_this.pid,code:_this.code},
                success:function(res){
                    layer.closeAll();
                    
                    $('#data-table tbody').remove();
                    $('#data-table').append(res);
                    $("#data-table").treeTable({
                        indent : 20
                    });
                }
            })
        }
    }
    $(document).ready(function() {
      Page.init();
      
    });
  </script>
    
<include file="Public:footer"/>