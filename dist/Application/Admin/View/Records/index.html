<include file="Public:header"/>
    <!-- begin #content -->
    <div id="content" class="content">
      <!-- begin page-header -->
      <h1 class="page-header">{$title}</h1>
      <!-- end page-header -->
      
      <!-- begin row -->
      <div class="row">
          <!-- begin col-12 -->
          <div class="col-md-12">
              <!-- begin panel -->
                    <div class="panel panel-inverse">
                        <div class="panel-body">
                                <div class="row manage-search">
                                  <div class="col-md-6 btnArea">

                                    <div class="dropdown">
                                        <!--<select class="form-control del1_status">-->
                                          <!--<option value="-1"><a href="javascript:;;">全部</a></option>-->
                                            <!--<?php foreach($engin_status as $k=>$v){ ?>-->
                                            <!--<option value="{$v['val']}">{$v['name']}</option>-->
                                            <!--<?php } ?>-->
                                        <!--</select>-->
                                    </div>
                                      {:create_Url('Admin/Records/add','+ 新增备案',null,'class="btn btn-danger m-l-10 m-b-5"')}
                                  </div>
                                  <div class="col-md-6 form-group" id='manage-right'></div>
                                </div>
                                <table id="data-table" class="table table-striped table-bordered">
                                    <thead>
                                        <th>序号</th>
                                        <th>备案编号</th>
                                        <th>出厂编号</th>
                                        <th>规格型号</th>
                                        <th>制造单位</th>
                                        <th>产权单位</th>
                                        <th>设备类型</th>
                                        <th>登记日期</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    <!-- end panel -->
                </div>
                <!-- end col-12 -->
            </div>
            <!-- end row -->
    </div>
    <!-- end #content -->

    <script>
    var Page = {
        init: function(){
            this.bind();
            this.renderTable();
        },
        bind: function(){
            var _this = this;
              //状态
            $(document).on('change', '.del_status', function() {
              _this.start_stop = $(this).val();
              _this.renderTable();
                })
            $(document).on('change', '.del1_status', function() {
              _this.type = $(this).val();
              _this.renderTable();
            })
            $(document).on('click','.del_Engineering',function(){
                var href = $(this).attr('href');
                var text = $(this).text();
                layer.confirm('确定'+text+'？', {
                    btn: ['确定','取消'] //按钮
                }, function(){
                    $.ajax({
                        url : href,
                        dataType:'json',
                        data:{
                            'do':'delete'
                        },
                        success: function(e){
                            // _this.renderTable();
                            if(e.status==0)
                            {
                              layer.alert(e.msg);
                              return false;
                            }
                            _this.renderTable();
                        }
                    })
                }, function(){
                    // 取消
                });
                return false;
            })
            $(document).on('click','.reset',function(){
                var href = $(this).attr('href');
                var text = $(this).text();
                layer.confirm('确定'+text+'？', {
                    btn: ['确定','取消'] //按钮
                }, function(){
                    $.ajax({
                        url : href,
                        dataType:'json',

                        success: function(e){
                            layer.alert(e.msg);
                            return false;
                        }
                    })
                }, function(){
                    // 取消
                });
                return false;

            })

            $(document).on('click','.shenhe',function(){
                var href = $(this).attr('href');
                var text = $(this).text();
                layer.confirm('该工程是否通过审核？', {
                    btn: ['通过','不通过'] //按钮
                }, function(){
                    $.ajax({
                        url : href,
                        dataType:'json',
                        data:{
                            'do':'shenhe',
                            'is_pass':'yes'
                        },
                        success: function(e){
                            // _this.renderTable();
                            if(e.status==0)
                            {
                                layer.alert(e.msg);
                                return false;
                            }
                            layer.closeAll();
                            layer.msg(e.msg, {time: 1500});
                            _this.renderTable();
                        }
                    })
                }, function(){
                    $.ajax({
                        url : href,
                        dataType:'json',
                        data:{
                            'do':'shenhe',
                            'is_pass':'no'
                        },
                        success: function(e){
                            // _this.renderTable();
                            if(e.status==0)
                            {
                                layer.alert(e.msg);
                                return false;
                            }
                            layer.closeAll();
                            layer.msg(e.msg, {time: 1500});
                            _this.renderTable();
                        }
                    })
                });
                return false;

            })
        },
        start_stop:0,
        type: "0",
        renderTable: function(){
            layer.load(1, {
              shade: [0.1,'#fff'] //0.1透明度的白色背景
            });
            var _this = this;
            if(this.tableInit){
                $('#data-table').DataTable().ajax.reload();
                return;
            }
            this.tableInit = true;
            _this.table = $('#data-table').DataTable({
                "ajax": {
                    url : '{:U('Records/index',array('do'=>'listTableData'))}',
                    data: function(){
                        return {

                            type:_this.type
                        }
                    }
                },
                "dom":'f<t>ip',
                //'searching':true,
                //多语言配置
                "language": Base.oLanguage,
                //默认排序列
                //"aaSorting": [[ 3, "asc" ]],
                "drawCallback": function(){
                    layer.closeAll();
                },
                // "searching":false,
                // "deferLoading":10000,
                "initComplete":function(row, data, start, end, display){
                  $('#manage-right').append($('#data-table_filter'));
                },
            });


        }
    }
    $(document).ready(function() {
      Page.init();
    });
  </script>
    
<include file="Public:footer"/>