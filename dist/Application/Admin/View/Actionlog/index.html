<include file="Public:header"/>
<style>
    .btn-group .btn.current {
        border-color: #d1d1d1!important;
        color: #535353;
        background: #fff;
        z-index: 9999;
    }
    .sorting_1{width:200px;}
</style>
<!-- begin #content -->
<div id="content" class="content">
  <!-- begin page-header -->
  <h1 class="page-header">{$title}</h1>
  <!-- end page-header -->
  
  <!-- begin row -->
  <div class="row">
      <!-- begin col-12 -->
      <div class="col-md-12">
          <!-- begin panel -->
          <div class="panel panel-inverse">
            <div class="panel-body">
                <div class="row manage-search">
                  <div class="col-md-8 btnArea">
                    <div class="btn-group m-r-10" role="group" aria-label="Default button group" style="float:left;">
                        <button type="button" data-type="today" class="time_select_btn btn btn-default">{:L('today')}</button>
                        <button type="button" data-type="yesterday" class="time_select_btn btn btn-default">{:L('yesterday')}</button>
                        <button type="button" data-type="day_before_yesterday" class="time_select_btn btn btn-default">{:L('byesterday')}</button>
                        <button type="button" data-type="7day" class="time_select_btn btn btn-default current">{:L('recent7days')}</button>
                        <button type="button" data-type="30day" class="time_select_btn btn btn-default">{:L('recent30days')}</button>
                        <button type="button" data-type="this_month" class="time_select_btn btn btn-default">{:L('thismonth')}</button>
                    </div>
                    <input type="text" class="form-control" style='width:200px;' id="ad_time">
                </div>
                <div class="col-md-4 form-group" id='manage-right'></div>
            </div>
            <table id="data-table" class="table table-striped table-bordered"style="width:100%;">
                <thead>
                    <th style="width:28px;">序号  </th>
                    <th>操作时间</th>
                    <th style="width: 64px;">操作用户</th>
                    <th>操作内容</th>
                </thead>
            </table>
        </div>
    </div>
    <!-- end panel -->
</div>
<!-- end col-12 -->
</div>
<!-- end row -->
</div>
<!-- end #content -->

<script type='text/javascript'>
    var Page = {
        init:function(){
            this.initDate();
            this.bind();
            $('.time_select_btn.current').click();
        },
        bind: function(){
            var _this = this;
            _this.start_time = "{:date('Y-m-01')}";
            _this.end_time = "{:date('Y-m-d')}";
            _this.setDateRange(_this.start_time, _this.end_time)
            $('.time_select_btn').click(function(){
                var type = $(this).data('type');
                var times = Base.getDateByType(type);
                _this.start_time = times[0];
                _this.end_time = times[1];
                $('.time_select_btn').removeClass('current');
                $(this).addClass('current');
                _this.setDateRange(times[0],times[1])
                _this.renderTable();
            })

        },
        initDate: function(){
            var _this = this;
            new pickerDateRange('ad_time', {
                isTodayValid : true,
                stopToday: false,
                suffix: 'ssp',
                startDate : '',
                endDate : '',
                defaultText : ' {:L('to')} ',
                inputTrigger : 'ad_time',
                theme : 'ta',
                success : function(obj) {
                    _this.start_time = obj.startDate;
                    _this.end_time = obj.endDate;
                    _this.renderTable();
                }
            });
        },
        setDateRange: function(start_time,end_time){
            $('#ad_time').val(start_time+' 至 '+end_time);
            $('#startDate_ssp').val(start_time);
            $('#endDate_ssp').val(end_time);
        },
        start_time: "",
        end_time: "",
        renderTable:function(){
                  layer.load(1, {
                    shade: [0.1,'#fff'] //0.1透明度的白色背景
                  });
                  var _this = this;
                  if(this.tableInit){
                      $('#data-table').DataTable().ajax.reload();
                      return;
                  }
                  this.tableInit = true;
                  _this.table = $('#data-table').DataTable({
                    "ajax": {
                        url : '{:U('Actionlog/index',array('do'=>'listTableData'))}',
                        data: function(){
                            return {
                                sdate: _this.start_time,
                                edate: _this.end_time
                            }
                        }
                    },
                    "dom": 'f<t>ip',
                    // 'searching':false,
                    //多语言配置
                    "language": Base.oLanguage,
                    //默认排序列
                    "aaSorting": [[ 1, "desc" ]],
                    "drawCallback": function(){
                      layer.closeAll();
                      var api = this.api();
                  　　 api.column(0,{
                        search: 'applied',
                        order: 'applied'
                      }).nodes().each(function(cell, i) {
                  　　　　cell.innerHTML =  i + 1;
                　　　 });
                  },
                  "initComplete": function(row, data, start, end, display) {
                      $('#manage-right').append($('#data-table_filter'));
                  }
              });
              },           
          };
          $(document).ready(function() {
              Page.init();
          });
      </script>
      
      <include file="Public:footer"/>