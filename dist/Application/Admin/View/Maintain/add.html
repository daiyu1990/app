<include file="Public:header"/>
<!-- begin #content -->
<div id="content" class="content">
  <!-- begin page-header -->
  <h1 class="page-header">{$title}</h1>
  <!-- end page-header -->   
  <!-- begin row -->
  <div class="row">
    <!-- begin col-6 -->
    <div class="col-md-12 admin-grid index-chart">
      <!-- begin panel -->
      <div class="panel panel-inverse" data-sortable-id="form-stuff-1">
        <div class="panel-body">
          <form class="form-horizontal" method='post' action='{:U("Maintain/".ACTION_NAME)}'>
            <input type='hidden' name='do' value="save"/>
            <if condition="ACTION_NAME eq 'edit'">
              <input type='hidden' name='id' value='{$info.id}'/>
            </if>
            <div class="form-group">
              <label class="col-md-3 control-label">设备编号</label>
              <div class="col-lg-5">
                <select class="form-control" id="facility_number" data-rule="设备编号:required" name="facility_id">
                  <option value="">请选择设备</option>
                  <foreach name="data" item="vo">
                    <if condition="$info['facility_id'] eq $vo['mid']">
                      <option value="{$vo['mid']}" selected>{$vo.facility_number}</option>
                      <else/>
                      <option value="{$vo['mid']}">{$vo.facility_number}</option>
                    </if>
                  </foreach>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">设备类型</label>
              <div class="col-lg-5">
                <select class="form-control" id="type" data-rule="设备类型:required">
                  <if condition="$typename">
                    <option value="{$typename.id}">{$typename.name}</option>
                  </if>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">设备地址</label>
              <div class="col-lg-5">
                <input type="text" id="address" data-rule="设备地址:required" class="form-control" name='address' placeholder="设备地址" value="{$info.address}"/>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">问题描述</label>
              <div class="col-lg-5">
                <textarea class="form-control" name="remark">{$info.remark}</textarea>
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-3 control-label">任务名称</label>
              <div class="col-lg-5">
                <input type="text" class="form-control" data-rule="任务名称:required" name='task_name'  placeholder="任务名称" value="{$info.task_name}"/>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">任务类型</label>
              <div class="col-md-5">
                <select class="form-control" data-rule="任务类型:required" name="task_typeid">
                  <foreach name="tasktype" item="vo">
                    <if condition="$info['task_typeid'] eq $vo['id']">
                      <option value="{$vo['id']}" selected>{$vo.name}</option>
                      <else/>
                      <option value="{$vo['id']}">{$vo.name}</option>
                    </if>
                  </foreach>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">联系电话</label>
              <div class="col-md-5">
                <input type="text" data-rule="联系电话:required" class="form-control" name='linkphone' value='{$info.linkphone}' placeholder="联系电话" />
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">联系人</label>
              <div class="col-md-5">
                <input type="text" data-rule="联系人:required" class="form-control" name='linkman' value='{$info.linkman}' placeholder="联系人" />
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">单位名称</label>
              <div class="col-md-5">
                <label style="text-align: left;width:100%;" class="col-md-3 control-label">{$company.name}</label>
                <input type="hidden"  class="form-control" name='company_id' value='{$company.id}' />
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">任务级别</label>
              <div class="col-md-5">
                <select class="form-control" data-rule="任务级别:required" name="level">
                  <option value="">--请选择级别--</option>
                  <option value="1" <if condition="$info['level'] eq 1">selected</if>>低</option>
                  <option value="2" <if condition="$info['level'] eq 2">selected</if>>中</option>
                  <option value="3" <if condition="$info['level'] eq 3">selected</if>>高</option>
                  <option value="4" <if condition="$info['level'] eq 4">selected</if>>紧急</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">选择任务指派公司</label>
              <div class="col-lg-5">
                <button class="btn btn-info btn-sm" type="button" id="chose_company">选择</button>
                <input type="hidden" name="appoint_id" id="company_id" value="{$info.appoint_id}">
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label">指派单位名称</label>
              <div class="col-lg-5">
                <label style="text-align: left;width:100%;" class="col-md-3 control-label" id="company_name">{$companymsg.name}</label>
              </div>
            </div>
            <div class="form-group">
              <div class="col-sm-offset-3 col-sm-2">
                <btn onclick="history.go(-1)" class='btn btn-sm btn-default m-r-5 btn-block'>返 回</btn>
              </div>
              <div class="col-sm-2">

                <button type="submit" class="btn btn-sm btn-danger btn-block">提 交</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <!-- end panel -->
    </div>
    <!-- end col-6 -->
  </div>
  <!-- end row -->
</div>
<!-- end #content -->
<script src="__PUBLIC__/assets/js/laydate/laydate.js"></script>

<script type='text/javascript'>
  var Page = {
    init:function(){
      this.bind();
    },
    bind:function(){
      var _this = this;
      $('#facility_number').change(function(){
        var num = $(this).val();
        $.post('__URL__/ajaxMsg',{id:num},function(data){
            $('#type').empty();
            $("<option></option>").val(data.id).text(data.name).appendTo($("#type"));
            $('#address').val(data.address);
            $('#company').val(data.company);
        },'json')
      })
      $('#chose_company').click(function(){
        var that = $(this);
        console.log('123');

        $.ajax({
          url:"{:U('/Admin/Records/company')}",
//          dataType:'json',
          type:'post',
          success:function(e){

            console.log(e);

            layer.open({
              title: '公司列表',
              type: 1,
              skin: 'layui-layer-demo', //加上边框
              anim: 5,
              area: ['750px', '600px'], //宽高
              content: e
            });
          }
        })

//        console.log(456);
//        return false;
      })
      $(function(){
        $('form').validator({
          theme:'yellow_top',
          msgClass:'n-right',
          msgIcon:'',
          msgMaker: function(opt){
            if(!opt.msg){
              return '';
            }
            return '<span class="msg-wrap n-error" role="alert"><span class="n-msg">'+opt.msg+'</span></span>'
          },
          messages: {
            match:{
              eq:"两次输入密码不一致！"
            }
          },
          fields: {
            'terminal_number':'终端编号:required;',
            'project_name': "工程名称:required;",
            'safe_supervise_site': "安全监督站:required;",
            'use_company': "使用单位:required;",
            'supervisor_company': "监理单位:required;",

          }
      });
      })
    },

    openLayer: function(title,url,width,height){
      if(width == ''){
        width = '1200px';
      }
      if(height == ''){
        height = '650px';
      }
      layer.open({
        type: 2,
        title: title,
        area: [width, height], //宽高
        closeBtn: 1, //不显示关闭按钮
        shift: 2,
        shadeClose: true, //开启遮罩关闭
        content: url
      });
    },
  }
  $(function(){
    Page.init();
  })
</script>
<include file="Public:footer"/>