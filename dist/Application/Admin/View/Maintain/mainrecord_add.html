<include file="Public:header"/>

<!-- begin #content -->
		<div id="content" class="content content_waring">	
			 <!-- begin page-header -->
		    <h1 class="page-header page_warging">
		    	<!--{$title}-->
		    	<a>维保管理 </a>》<a>报修详情</a>》<a>{$title}</a>
		    	<a onclick="javascript:history.go(-1);" class="organ_back">
			    		<i class="engin_back"></i>
    					<span class="engin_add_text">返回</span>
			    </a>
		    </h1>
		    <!-- end page-header -->
			<!--总标题-->
			<div class="equip_head engin_head">
				<!--{$title}-->
				任务详情
			</div>
			<!--设备信息-->
			<form name="form1" id="form1" method="post" enctype="multipart/form-data" action='{:U("Admin/Maintain/".ACTION_NAME)}' >
				<input name="do" value="save" type="hidden">
				<?php if(ACTION_NAME=='mainrecord_edit'): ?>
				<input type="hidden" name="id" value="{$info.id}" >
				<?php endif; ?>
			<div class="equip_info">
				<div class="equip_infomation">
					<!--设备信息编辑-->
						<div class="detail-body engin_edit_box clearfix">
							<div class="equip_list engin_boxt clearfix row">
								<!--<div class="col-md-4">-->
									<!--<div class="cheitm">-->
										<!--<label class="ifro_item">-->
											<!--<span class="info_man engin_span">任务编号：</span>-->
											<!--<span class="check_inp check_inp_span">26565656565265</span>-->
										<!--</label>-->
									<!--</div>-->
								<!--</div>-->
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>产权编号：</span>
											<select id="r_id" name="r_id" class="check_inp chosen-select" >
												<option value="">请选择产权备案编号</option>
												<?php foreach($beian as $k=>$v){ ?>
												<?php if($v['id'] == $info['r_id']): ?>
												<option selected="selected" value="{$v.id}">{$v.beian_code}</option>
												<?php else: ?>
												<option value="{$v.id}">{$v.beian_code}</option>
												<?php endif; ?>
												<?php } ?>

											</select>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">设备类型：</span>
											<input type="hidden" name="f_id" value="{$info.f_id}" id="f_id">
											<span id="fac_type" class="check_inp check_inp_span">{$info.facility_type}</span>
										</label>
									</div>
								</div>

							</div>

							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">设备编号：</span>
											<span id="fac_code" class="check_inp check_inp_span">{$info.facility_number}</span>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>设备地址：</span>
											<input type="text" id="address" value="{$info.address}" name="address" class="check_inp" placeholder=" 输入设备所在地址" />
										</label>
									</div>
								</div>
							</div>

							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6" >
									<div class="cheitm">
										<label  class="ifro_item">
											<span  class="info_man engin_span"><i class="required_fields">*</i>问题描述：</span>
											<input type="text" id="wenti" value="{$info.wenti}" name="wenti" class="check_inp" placeholder=" 请描述出现的问题" />

										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>任务名称：</span>
											<input type="text" name="name" value="{$info.name}" id="name" class="check_inp" placeholder=" 请输入任务名称" />
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>任务类型：</span>
											<select name="type" id="type" class="organ-info cenz check_inp check_inps" >
			                                    <option value="">请选择任务类型</option>
			                                    <option <?php if($info['type']==1): ?>selected="selected"<?php endif; ?> value="1">设备报修</option>
			                                    <option <?php if($info['type']==2): ?>selected="selected"<?php endif; ?> value="2">设备保养</option>
			                                    <option <?php if($info['type']==3): ?>selected="selected"<?php endif; ?> value="3">设备巡检</option>
			                                    <option <?php if($info['type']==4): ?>selected="selected"<?php endif; ?> value="4">设备咨询</option>
			                                </select>
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>联系人：</span>
											<input type="text" id="contact" value="{$info.contact}" name="contact" class="check_inp" placeholder=" 请输入联系人姓名" />
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>联系电话：</span>
											<input type="text" name="mobile" value="{$info.mobile}" id="mobile" class="check_inp" placeholder=" 请输入联系电话" />
										</label>
									</div>
								</div>

							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>任务级别：</span>
											<select id="level" name="level" class="organ-info cenz check_inp check_inps" >
			                                    <option value="">请选择任务级别</option>
			                                    <option <?php if($info['level']==1): ?>selected="selected"<?php endif; ?> value="1">低</option>
			                                    <option <?php if($info['level']==2): ?>selected="selected"<?php endif; ?> value="2">中</option>
			                                    <option <?php if($info['level']==3): ?>selected="selected"<?php endif; ?> value="3">高</option>
			                                    <option <?php if($info['level']==4): ?>selected="selected"<?php endif; ?> value="4">紧急</option>
			                                </select>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>任务指派企业：</span>
											<select id="work_company" name="work_company" class="check_inp chosen-select" >
												<option value="">请选择任务指派企业</option>
												<?php foreach($company as $k=>$v){ ?>
												<?php if($v['id'] == $info['work_company']): ?>
												<option selected="selected" value="{$v.id}">{$v.name}</option>
												<?php else: ?>
												<option value="{$v.id}">{$v.name}</option>
												<?php endif; ?>
												<?php } ?>

											</select>
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">任务开始日期：</span>
											<input type="text" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" name="start" value="{$info.start}" id="start" class="check_inp" placeholder=" 请选择任务开始日期" />
										</label>
									</div>
								</div>

								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">任务截止日期：</span>
											<input type="text" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" name="end" value="{$info.end}" id="end" class="check_inp" placeholder=" 请选择任务截止日期" />
										</label>
									</div>
								</div>
							</div>
						</div>
					</div>
				<!--完成-->
				<div class="add_finish equip_finish">
					<a href="javascript:0" id="save" class="opass equipfinish engin_finish">保存</a>
					<a onclick="javascript:history.go(-1);" class="opass equipfinish engin_finish_exit">取消</a>
				</div>	
			</div><!--equip_infomation-->
			</form>
			
		</div>

<!--content-->

<script src="__PUBLIC__/assets/js/laydate/laydate.js"></script>
<script>

	$(document).on('click','#save',function(){
		var r_id = $('#r_id').val();
		var f_id = $('#f_id').val();
		var address = $('#address').val();
		var wenti = $('#wenti').val();
		var name = $('#name').val();
		var type = $('#type').val();
		var contact = $('#contact').val();
		var mobile = $('#mobile').val();
		var level = $('#level').val();
		var work_company = $('#work_company').val();
		var start = $('#start').val();
		var end = $('#end').val();

		if(r_id == '' ){
			layer.msg('产权备案编号不能为空', {time: 1500});
			return false;
		}

		if(address == '' ){
			layer.msg('设备地址不能为空', {time: 1500});
			return false;
		}

		if(wenti == '' ){
			layer.msg('问题描述不能为空', {time: 1500});
			return false;
		}

		if(name == '' ){
			layer.msg('任务名称不能为空', {time: 1500});
			return false;
		}

		if(type == '' ){
			layer.msg('任务类型不能为空', {time: 1500});
			return false;
		}

		if(contact == '' ){
			layer.msg('联系人不能为空', {time: 1500});
			return false;
		}

		if(mobile == '' ){
			layer.msg('联系电话不能为空', {time: 1500});
			return false;
		}

		if(level == '' ){
			layer.msg('任务等级不能为空', {time: 1500});
			return false;
		}

		if(work_company == '' ){
			layer.msg('任务指派企业不能为空', {time: 1500});
			return false;
		}

		if(start == '' ){
			layer.msg('任务开始日期不能为空', {time: 1500});
			return false;
		}

		if(end == '' ){
			layer.msg('任务截止日期不能为空', {time: 1500});
			return false;
		}

		if(start>end){
			layer.msg('任务开始日期不能晚于任务截止日期', {time: 1500});
			return false;
		}





		layer.load(1, {
			shade: [0.1,'#fff'] //0.1透明度的白色背景
		});

		$('#form1').ajaxSubmit({
			dataType:'json',
			success:function(res){
				layer.closeAll();
				if(res.status !=1){
					layer.msg('保存失败，请重试', {time: 1500});
					return false;
				}else{

					layer.closeAll();
					layer.msg('保存成功', {time: 1500},function(){
						javascript:history.go(-1);
					});

				}
			}
		});


	})

	$(document).on('change','#r_id',function(){

		var id = $(this).val();
		if(id==''){
			return false;
		}

		layer.load(1, {
			shade: [0.1,'#fff'] //0.1透明度的白色背景
		});

		$.ajax({
			url:"{:U('Admin/File/install_add')}",
			dataType:'json',
			type:'post',
			data:{
				'do':'get_record',
				'id':id
			},
			success:function(e){
				layer.closeAll();
				if(e.status!=1){
					layer.msg('获取产权信息失败，请重试', {time: 1500});
					return false;
				}


				$('#f_id').val(e.data.id);
				$('#fac_code').text(e.data.facility_number);
				$('#fac_type').text(e.data.facility_type);


				return false;

			}
		})
	})


	window.onload=function(){

		$('.chosen-single').css('background-color','rgba(51,51,51,0.1)');
		$('.chosen-container-single').css('margin-left','13px');
	}
</script>
<include file="Public:footer"/>