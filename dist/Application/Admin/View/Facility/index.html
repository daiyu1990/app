<include file="Public:header"/>
<!-- begin #content -->
<div id="content" class="content">
    <!-- begin page-header -->
    <h1 class="page-header">{$title}</h1>
    <!-- end page-header -->

    <!-- begin row -->
    <div class="row">
        <!-- begin col-12 -->
        <div class="col-md-12">
            <!-- begin panel -->
            <div class="panel panel-inverse">
                <div class="panel-body">
                    <div class="row manage-search">
                        <div class="col-md-6 btnArea">
                            <div class="dropdown">

                            </div>
                            {:create_Url('Admin/Facility/add','+ 添加设备',null,'class="btn btn-danger m-b-10"')}
                        </div>
                        <div class="col-md-6 form-group" id='manage-right'></div>
                    </div>
                    <table id="data-table" class="table table-striped table-bordered">
                        <thead>
                        <th>ID</th>
                        <th>产权编号</th>
                        <th>设备类型</th>
                        <th>设备编号</th>
                        <th>设备型号</th>
                        <th>制造单位</th>
                        <th>登记日期</th>
                        <th>操作</th>
                        </thead>
                    </table>
                </div>
            </div>
            <!-- end panel -->
        </div>
        <!-- end col-12 -->
    </div>
    <!-- end row -->
</div>
<!-- end #content -->

<script>
    var Page = {
        init: function(){
            this.bind();
            this.renderTable();
        },
        bind: function(){
            var _this = this;
            //状态
            $(document).on('change', '.del_status', function() {
                _this.start_stop = $(this).val();
                $('#dropdownMenu2').text($(this).text());
                _this.renderTable();
            })
            $(document).on('click','.del',function(){
                var href = $(this).attr('href');
                var text = $(this).text();
                layer.confirm('确定'+text+'？', {
                    btn: ['确定','取消'] //按钮
                }, function(){
                    $.ajax({
                        url : href,
                        dataType:'json',
                        success: function(e){
                            // _this.renderTable();
                            if(e.status==0)
                            {
                                layer.alert(e.msg);
                                return false;
                            }
                            _this.renderTable();
                        }
                    })
                }, function(){
                    // 取消
                });
                return false;
            })
            $(document).on('click','#addcode',function(){
                var that = $(this);
                $.ajax({
                    url : that.attr('href'),
                    success:function(result){
                        _this.openLayer(that.text(),result,'600px','400px');
                    }
                })
                return false;
            })
        },
        openLayer: function(title,html,width,height){
            if(width == ''){
                width = '1000px';
            }
            if(height == ''){
                height = '650px';
            }
            layer.open({
                type: 1,
                title: title,
                area: [width, height], //宽高
                closeBtn: 1, //不显示关闭按钮
                shift: 2,
                shadeClose: true, //开启遮罩关闭
                content: html
            });
        },
        start_stop:0,
        renderTable: function(){
            layer.load(1, {
                shade: [0.1,'#fff'] //0.1透明度的白色背景
            });
            var _this = this;
            if(this.tableInit){
                $('#data-table').DataTable().ajax.reload();
                return;
            }
            this.tableInit = true;
            _this.table = $('#data-table').DataTable({
                        "ajax": {
                            url : '{:U('Facility/index',array('do'=>'listTableData'))}',
                        data: function(){
                            return {
                                start_stop: _this.start_stop,
                            }
                        }
                    },
                    "dom":'f<t>ip',
                //'searching':true,
                //多语言配置
                    "language": Base.oLanguage,
                //默认排序列
                //"aaSorting": [[ 3, "asc" ]],
                    "drawCallback": function(){
                layer.closeAll();
            },
            // "searching":false,
            // "deferLoading":10000,
            "initComplete":function(row, data, start, end, display){
                $('#manage-right').append($('#data-table_filter'));
            },
        });


        }
    }
    $(document).ready(function() {
        Page.init();
    });
</script>

<include file="Public:footer"/>