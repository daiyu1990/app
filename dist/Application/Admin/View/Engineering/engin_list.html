<include file="Public:header"/>
<!-- begin #content -->
<div id="content" class="content content_waring">
    <!-- begin page-header -->
    <h1 class="page-header page_warging">
    	<!--{$title}-->
    	<a>工程管理 </a>》<a>{$title}</a>
    	<a class="organ-add" href="{:U('Admin/Engineering/engin_add')}">
    		<i class="engin_add"></i>
    		<span class="engin_add_text">新增工程</span>
    	</a>
    </h1>
    <!-- end page-header -->

    <!-- begin row -->
    <div class="row">
        <!-- begin col-12 -->
        <div class="col-md-12">
            <!-- begin panel -->
            <div class="panel panel-inverse engin_panel">
                <div class="panel-body">
                    <div class="row organ-form_waring">
                       		<div class="clearfix fl oragan_infrl">
								<label class="organ-item">
									<span class="organ-itemt">工程编号：</span>
									<input type="text" id="code" class="organ-info" placeholder="输入工程编号"/>
								</label>
								<label class="organ-item">
									<span class="organ-itemt">工程名称：</span>
									<input type="text" id="name" class="organ-info" placeholder="输入工程名称"/>
								</label>
								<label class="organ-item">
									<span class="organ-itemt">所在地区：</span>
									<div class="layui-input-inline" style="width: 112px;">
								      <select name="quiz1" id="sheng" class="organ-info check_inpld" >
								        <option value="0">省（全部）</option>

										  <?php foreach($sheng as $k=>$v){ ?>
										  <?php if($v['id'] == $info['sheng_id']): ?>
										  <option selected="selected" value="{$v['id']}">{$v['name']}</option>
										  <?php else: ?>
										  <option value="{$v['id']}">{$v['name']}</option>
										  <?php endif; ?>
										  <?php } ?>
								      </select>
								    </div>
								    <div class="layui-input-inline" style="width: 112px;">
								      <select name="quiz2" id="shi" class="organ-info check_inpld" >
								        <option value="0">请先选择省份</option>
								      </select>
								    </div>
								</label>

								<label class="organ-item">
								    <div class="btn-group">
		                               <label style="display: block; float: left; " for="from"><span  class="fl organ-itemt datail-date">登记日期：</span></label>
	                                   <label class="start-tims">
	                                        <span class="engine_date_position"><i class="fa engine_date"></i></span>
	                                        <input id="from" name="from" onclick="laydate()" placeholder='开始日期' value="" class="fl organ-info_engin picker-date">
	                                   </label>
	                                    <label class="engin_label" for="to">－</label>
	                                    <label class="start-tims">
	                                        <span class="engine_date_position"><i class="fa engine_date"></i></span>
	                                        <input id="to" name="from" onclick="laydate()" placeholder='截止日期' value="" class="fl organ-info_engin picker-date">
	                                   </label>
		                            </div>
								</label>
							</div>
							<div class="organ-formlt fl oagan_checkt">
								<a id="search" class="refer_equiplist refer_engin refer">查询</a>
							</div>
                	</div>
                    <!--<div class="table-responsive">-->
	                    <table id="data-table" class="table tj_table engin_table table-striped">
	                        <thead>
	                        	<th>选择</th>
		                        <th>工程编号</th>
		                        <th>工程名称</th>
		                        <th>地区</th>
		                        <th>建设单位</th>
		                        <th>施工单位</th>
		                        
		                       	<th>塔机数量</th>
		                        <th>升降机数量</th>
		                        <th>审核状态</th>
		                        <th>查看</th>
		                        <th>编辑</th>
	                        </thead>
	                        <tbody id="position">

							</tbody>
	                    </table>

					<div class="paging_lister" id="page_position">

						<button id="del" class="btn btn-default btn-sm" style="margin-top:25px;float:left; background-color: #3c3c3c; color: white;">删除选中</button>

					</div>
                </div>
            </div>
            <!-- end panel -->
        </div>
        <!-- end col-12 -->
    </div>
    <!-- end row -->
</div>
<!-- end #content -->
<script src="__PUBLIC__/assets/js/laydate/laydate.js"></script>
<script>


	var Page = {
		init: function(){
			this.bind();
			this.renderTable();
		},
		bind: function(){
			var _this = this;
			//状态

			$(document).on('click','#del',function(){

				var id='';
				$('.check-item').each(function(){
					if($(this).is(':checked')){
						id+=','+$(this).val();
					}
				})

				if(id==''){
					layer.msg('请至少选择一项', {time: 1500});
					return false;
				}else{
					id = id.replace(',','');
					layer.load(1, {
						shade: [0.1,'#fff'] //0.1透明度的白色背景
					});

					$.ajax({
							<?php if(ACTION_NAME=='engin_list'): ?>
							url : '{:U('Engineering/engin_list')}',
							<?php else: ?>
							url : '{:U('Engineering/c_engin_list')}',
							<?php endif; ?>
						dataType:'json',
						type:'post',
						data:{
							'do':'del',
							'id':id
						},
						success:function(e){
							layer.closeAll();
							if(e.status!=1){
								layer.msg('删除失败，请重试', {time: 1500});
								return false;
							}

							layer.msg('删除成功', {time: 1500});
							_this.renderTable();
						}
					})

				}
			})

			$(document).on('click','#search',function(){

				var code = $('#code').val();
				var name = $('#name').val();
				var sheng = $('#sheng').val();
				var shi = $('#shi').val();
				var start = $('#from').val();
				var end = $('#to').val();


				if(start!=''&&end!=''&&start>end){
					layer.msg('开始日期不能晚于截止日期', {time: 1500});
					return false;
				}
					_this.code = code;
					_this.name = name;
					_this.sheng = sheng;
					_this.shi = shi;
					_this.start = start;
					_this.end = end;


				_this.renderTable();
			})

			$('#sheng').change(function(){
				var sheng = $('#sheng').val();
				if(sheng==''){
					$('#shi').html("<option value=''>请先选择省份</option>");
					return false;
				}if(sheng=='47494' || sheng=='47495'){
					$('#shi').html("<option value='0'>---</option>");
					return false;
				}else{
					layer.load(1, {
						shade: [0.1,'#fff'] //0.1透明度的白色背景
					});
					$.ajax({

						url:"{:U('Admin/Engineering/engin_add')}",
						dataType:'json',
						type:'post',
						data:{
							'sheng':sheng,
							'do':'get_shi'
						},
						success:function(e){
							if(e.status !=1){
								layer.closeAll();
								layer.msg(e.msg, {time: 1500});
								return false;
							}

							var html = "<option value=''>请选择城市</option>";

							for(i=0;i<e.data.length;i++){
								html+='<option value="'+ e.data[i].id+'">'+e.data[i].name+'</option>';
							}

							$('#shi').html(html);
							layer.closeAll();
						}
					})
				}

			})
		},
		code: "",
		name: "",
		sheng: "0",
		shi: "0",
		start:"",
		end:"",
		renderTable: function(){
			layer.load(1, {
				shade: [0.1,'#fff'] //0.1透明度的白色背景
			});
			var _this = this;
			if(this.tableInit){
				$('#data-table').DataTable().ajax.reload();
				return;
			}
			this.tableInit = true;
			_this.table = $('#data-table').DataTable({
						"ajax": {
							<?php if(ACTION_NAME=='engin_list'): ?>
							url : '{:U('Engineering/engin_list',array('do'=>'listTableData'))}',
							<?php else: ?>
							url : '{:U('Engineering/c_engin_list',array('do'=>'listTableData'))}',
							<?php endif; ?>
						data: function(){
							return {

								code:_this.code,
								name:_this.name,
								sheng:_this.sheng,
								shi:_this.shi,
								start:_this.start,
								end:_this.end
							}
						}
					},
					"dom":'f<t>ip',
				//'searching':true,
				//多语言配置
					"language": Base.oLanguage,
				//默认排序列
				"aaSorting": [[ 0, "asc" ]],
					"drawCallback": function(){
				layer.closeAll();
			},
			// "searching":false,
			// "deferLoading":10000,
			"initComplete":function(row, data, start, end, display){
				$('#manage-right').append($('#data-table_filter'));
			},
		});


		}
	}
	$(document).ready(function() {
		Page.init();
	});









//	$(document).ready(function(){
//
//		layer.load(1, {
//			shade: [0.1,'#000'] //0.1透明度的白色背景
//		});
//
//
//		$.ajax({
//			url:"{:U('Admin/Engineering/engin_list')}",
//			dataType:'json',
//			type:'post',
//			data:{
//				'do':'search',
//			},
//			success:function(e){
//				var i = 0;
//				var html = '';
//				var len = e.info.length;
//				var j;
//				for(i=0;i<len;i++){
//					 j = i+1;
//					html+=  '<tr>'+
//								'<td>'+
//									'<label class="select-check">'+
//										'<input type="checkbox" value="'+ e.info[i].id +'" class="fl check-item">'+
//											'<span class="fl">'+ j +'</span>'+
//									'</label>'+
//								'</td>'+
//								'<td>'+ e.info[i].code +'</td>'+
//								'<td>'+ e.info[i].name +'</td>'+
//								'<td>'+ e.info[i].diqu +'</td>'+
//								'<td>'+ e.info[i].jianshe +'</td>'+
//								'<td>'+ e.info[i].chengjian +'</td>'+
//								'<td data-target="#enginModal" data-toggle="modal" style="display: block;">'+ e.info[i].taji +'</td>'+
//								'<td>'+ e.info[i].shengjiangji +'</td>'+
//								'<td><a href="'+'Admin/Engineering/engin_detail/id/'+ e.info[i].id +'" id="organ_check"><i class="organ-look"></i></a></td>'+
//								'<td><a href="'+'Admin/Engineering/engin_edit/id/'+ e.info[i].id +'" id="organ_item"><i class="organ-editt"></i></a></td>'+
//							'</tr>';
//				}
//
////				var page = e.page;
//
//				$('#position').html(html);
////				$('#page_position').html(e.page);
//				layer.closeAll();
//
//
//			}
//		});
//
//
//
//	});
</script>

<include file="Public:footer"/>