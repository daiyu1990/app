<include file="Public:header"/>
   <!-- begin #content -->
    <div id="content" class="content">
      <!-- begin page-header -->
      <h1 class="page-header">{$title}</h1>
      <!-- end page-header -->   
      <!-- begin row -->
      <div class="row">
                <!-- begin col-6 -->
          <div class="col-md-12 admin-grid index-chart">
            <if condition="in_array(session('userinfo.groupid'),$group_arr)">
                    <ul class="nav nav-tabs nav-tabs-inverse nav-justified nav-justified-mobile" data-sortable-id="index-2">
                        <li class="active"><a href="#login-password" data-toggle="tab"><i class="fa fa-tag m-r-5"></i> <span class="hidden-xs">登录密码</span></a></li>
                        
                            <li class=""><a href="#pay-password" data-toggle="tab"><i class="fa fa-unlock-alt m-r-5"></i> <span class="hidden-xs">支付密码</span></a></li>
                    </ul>
            </if>
              <!-- begin panel -->
              <div class="tab-content" data-sortable-id="index-3">
                    <div class="tab-pane fade active in" id='login-password' data-sortable-id="form-stuff-1">
                            <form class="form-horizontal" method='post' action='{:U("User/".ACTION_NAME)}'>
                                <input type='hidden' name='do' value='save'/>
                                <input type='hidden' name='type' id='type' value='login'/>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">用户名称</label>
                                    <div class="col-lg-5" style="margin-top: 7px;">
                                        {:session('userinfo.username')}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">旧密码</label>
                                    <div class="col-lg-5">
                                        <input type="password" class="form-control" name='old' placeholder="密码" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">新密码</label>
                                    <div class="col-lg-5">
                                        <input type="password" class="form-control" name='password' placeholder="新密码" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">再次输入新密码</label>
                                    <div class="col-lg-5">
                                        <input type="password" class="form-control" name='password2' placeholder="再次输入新密码" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-2">

                                    </div>
                                    <div class="col-sm-2">
                                        <button type="submit" class="btn btn-sm btn-danger btn-block">提 交</button>
                                    </div>
                                </div>
                            </form>
                    </div>
                    <if condition="in_array(session('userinfo.groupid'),$group_arr)">
                    <div class="tab-pane fade" id='pay-password' data-sortable-id="form-stuff-1">
                            <form class="form-horizontal" method='post' action='{:U("User/".ACTION_NAME)}'>
                                <input type='hidden' name='do' value='save'/>
                                <input type='hidden' name='type' id='type' value='pay'/>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">用户名称</label>
                                    <div  class="col-lg-5"style="margin-top:7px;">
                                        {:session('userinfo.username')}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">旧密码</label>
                                    <div class="col-lg-5">
                                        <input type="password" class="form-control" name='old' placeholder="密码" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">新密码</label>
                                    <div class="col-lg-5">
                                        <input type="password" class="form-control" name='password' placeholder="新密码" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">再次输入新密码</label>
                                    <div class="col-lg-5">
                                        <input type="password" class="form-control" name='password2' placeholder="再次输入新密码" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-2">

                                    </div>
                                    <div class="col-sm-2">
                                        <button type="submit" class="btn btn-sm btn-danger btn-block">提 交</button>
                                    </div>
                                </div>
                            </form>
                    </div>
                    </if>
                    <!-- end panel -->
                </div>
                </div>
                <!-- end col-6 -->
            </div>
            <!-- end row -->
    </div>
    <!-- end #content -->
    <script type='text/javascript'>
      $(function(){
        $('form').validator({
            theme:'yellow_top',
            msgClass:'n-right',
            msgIcon:'',
            messages:{
                'match':{
                  eq:'两次密码不一致'
                },
            },
            msgMaker: function(opt){
              if(!opt.msg){
                return '';
              }
              return '<span class="msg-wrap n-error" role="alert" style="top:3px;"><span class="n-msg">'+opt.msg+'</span></span>'
            },
            fields: {
                'old': "原始密码:required;remote[post:{:U('Admin/User/modifypass')}, type]",
                'password': "新密码:required;",
                'password2': "再次输入密码:required;match(password)",
            },
            valid: function(form){
                var loading=layer.load(1, {
                    shade: [0.1, '#fff'] //0.1透明度的白色背景
                });;
                var options = {
                    success: function (e) {
                        layer.close(loading);
                        layer.confirm(e.msg, {
                            btn: ['确定'], //按钮
                            closeBtn:0,
                        }, function() {
                            layer.closeAll();
                            layer.msg('修改密码成功！');
                            if(e.status == 1){
                              window.location.href='{:U("Login/index",array('u'=>session('userinfo.username')))}';
                            }else if(e.status == 2){
                                window.location.href = '{:U("Index/index/")}';
                            }
                            // window.location.href='{:U("Login/index",array('check_alert'=>1))}#adminInfo';
                        });

                    }
                };
                $(form).ajaxSubmit(options);
                return false;
            }
        });
      })
    </script>
 <include file="Public:footer"/>