<include file="Public:header"/>

<!-- begin #content -->
		<div id="content" class="content content_waring">	
			 <!-- begin page-header -->
		    <h1 class="page-header page_warging">
		    	<!--{$title}-->
		    	<a>档案管理 </a>》<a>产权备案</a>》<a>{$title}</a>
		    	<a onclick="javascript:history.go(-1);" class="organ_back">
			    		<i class="engin_back"></i>
    					<span class="engin_add_text">返回</span>
			    </a>
		    </h1>
		    <!-- end page-header -->
			<!--总标题-->
			<form name="form1" id="form1" method="post" enctype="multipart/form-data" action='{:U("Admin/File/".ACTION_NAME)}' >
			<input type="hidden" name="do" value="save">
			<?php if(ACTION_NAME=='record_edit'): ?>
				<input type="hidden" name="id" value="{$info.id}">
			<?php endif; ?>


			<div class="equip_head engin_head">
				<!--{$title}-->
				新增备案
			</div>
			<!--产权单位信息-->
			<div class="equip_info ">
				<div class="equip_title engin_title">
					<i class="equip_i"></i>
					<span>产权单位信息</span>
				</div>
				<div class="equip_infomation">
					<!--基本工程信息编辑-->
						<div class="detail-body engin_edit_box clearfix">
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>产权单位：</span>
											<select id="chanquan" name="chanquan" class="check_inp chosen-select" >
												<option value="">请选择产权单位</option>
												<?php foreach($company as $k=>$v){ ?>
												<?php if($v['id'] == $info['chanquan']): ?>
												<option selected="selected" value="{$v.id}">{$v.name}</option>
												<?php else: ?>
												<option value="{$v.id}">{$v.name}</option>
												<?php endif; ?>
												<?php } ?>

											</select>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">营业执照注册号：</span>
											<span id="license_code" class="check_inp check_inp_span">{$info.license_code}</span>
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">单位地址：</span>
											<span id="diqu1" class="check_inp check_inp_span">{$info.diqu}</span>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">产权所在地：</span>
											<span id="diqu2" class="check_inp check_inp_span">{$info.diqu}</span>
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">法定代表人：</span>
											<span id="faren" class="check_inp check_inp_span">{$info.faren}</span>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">法定代表人联系电话：</span>
											<span id="faren_mobile" class="check_inp check_inp_span">{$info.faren_mobile}</span>
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>技术负责人：</span>
											<input type="text" name="jishu" id="jishu" value="{$info.jishu}" class="check_inp" placeholder=" 输入技术负责人姓名" />
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>技术负责人联系电话：</span>
											<input type="text" id="jishu_mobile" name="jishu_mobile" value="{$info.jishu_mobile}" class="check_inp" placeholder=" 输入联系电话" />
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>设备管理负责人：</span>
											<input type="text" id="guanli" name="guanli" value="{$info.guanli}" class="check_inp" placeholder=" 输入技术负责人姓名" />
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>设备管理负责人联系电话：</span>
											<input type="text" id="guanli_mobile" name="guanli_mobile" value="{$info.guanli_mobile}" class="check_inp" placeholder=" 输入联系电话" />
										</label>
									</div>
								</div>
							</div>
						</div>
						</div>
				</div><!--equip_infomation-->
			
			<!--设备基本信息-->
			<div class="equip_info equip_infot">
				<div class="equip_title engin_title">
					<i class="equip_i"></i>
					<span>设备基本信息</span>
				</div>
				<div class="equip_infomation">
					<!--基本工程信息编辑-->
						<div class="detail-body engin_edit_box clearfix">
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>设备编号：</span>
											<select id="fac_id" name="fac_id" class="check_inp chosen-select" >
												<option value="">请选择设备编号</option>
												<option selected="selected" value="{$info.f_id}">{$info.facility_number}</option>
												<?php foreach($fac as $k=>$v){ ?>
												<option value="{$v.id}">{$v.facility_number}</option>
												<?php } ?>

											</select>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">设备类型：</span>
											<span id="type"  class="check_inp check_inp_span">{$info.facility_type}</span>
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">设备型号：</span>
											<span id="xinghao" class="check_inp check_inp_span">{$info.facility_model_number}</span>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">出厂日期：</span>
											<span id="chuchang" class="check_inp check_inp_span">{$info.factory_date}</span>
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">制造许可证编号：</span>
											<span id="xuke" class="check_inp check_inp_span">{$info.manufacturing_licence_number}</span>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span">制造单位：</span>
											<span id="make_company" class="check_inp check_inp_span">{$info.make_company}</span>
										</label>
									</div>
								</div>
							</div>
							<!--<div class="equip_list engin_boxt clearfix row">-->
								<!--<div class="col-md-6">-->
									<!--<div class="cheitm">-->
										<!--<label class="ifro_item">-->
											<!--<span class="info_man engin_span">产品合格证号：</span>-->
											<!--<span id="hege" class="check_inp check_inp_span"></span>-->
										<!--</label>-->
									<!--</div>-->
								<!--</div>-->
								<!--<div class="col-md-6">-->
									<!--<div class="cheitm">-->
										<!--<label class="ifro_item">-->
											<!--<span class="info_man engin_span">监督检验证证号：</span>-->
											<!--<span class="check_inp check_inp_span">FDGDH-FCDSF-436</span>-->
										<!--</label>-->
									<!--</div>-->
								<!--</div>-->
							<!--</div>-->
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>安装/存放地址：</span>
											<input type="text" name="address" id="address" value="{$info.address}" class="check_inp" placeholder=" 输入地址" />
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>设备来源：</span>
											 <select id="laiyuan" name="laiyuan" class="organ-info cenz check_inp check_inps" >
			                                    <option value="">请选择设备来源</option>
			                                    <option <?php if($info['laiyuan']==1): ?>selected="selected"<?php endif; ?> value="1">自有</option>
			                                    <option <?php if($info['laiyuan']==2): ?>selected="selected"<?php endif; ?> value="2">租赁</option>
			                                </select>
										</label>
									</div>
								</div>
							</div>
							<!--<div class="equip_list engin_boxt clearfix row">-->
								<!--<div class="col-md-6">-->
									<!--<div class="cheitm">-->
										<!--<label class="ifro_item">-->
											<!--<span class="info_man engin_span">购置日期：</span>-->
											<!--<input id="start_time" onclick="laydate()" name="start_time"  placeholder='年-月-日' value="" class="fl check_inp check_inp_date picker-date">-->
										<!--</label>-->
									<!--</div>-->
								<!--</div>	-->
							<!--</div>-->
						</div>
						</div>
				</div><!--equip_infomation-->
				<!--设备技术参数-->
				<div class="equip_info equip_infot">
					<div class="equip_title engin_title">
						<i class="equip_i"></i>
						<span>设备技术参数</span>
					</div>
					<div class="equip_infomation">
						<!--设备参数表格-->
						<div class="detail-body clearfix">
							<div class="table">
								<table class="layui-table" lay-skin="line">
									<thead>
									<tr>
										<th>序号</th>
										<th></th>
										<th>参数类别</th>
										<th>参数名称</th>
										<th>参数值</th>
										<th>备注</th>
									</tr>
									</thead>
									<tbody id="position">
									<?php foreach($info['param'] as $k=>$v){ ?>
									<tr>
										<td>{$k+1}</td>
										<td></td>
										<td>{$v.type}</td>
										<td>{$v.name}</td>
										<td>{$v.value}</td>
										<td>{$v.mark}</td>
									</tr>
									<?php } ?>
									</tbody>
								</table>
							</div>
						</div>
					</div><!--equip_infomation-->
				</div><!--equip_info-->
			<!--备案信息-->
			<div class="equip_info equip_infot" style="padding: 0 20px 20px 20px !important;">
				<div class="equip_title engin_title">
					<i class="equip_i"></i>
					<span>备案信息</span>
				</div>
				<div class="equip_infomation">
					<!--基本工程信息编辑-->
						<div class="detail-body engin_edit_box clearfix">
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>产权备案编号：</span>
											<input type="text" value="{$info.beian_code}" name="beian_code" id="beian_code" class="check_inp" placeholder=" 输入产权备案编号" />
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>备案档案编号：</span>
											<input type="text" id="dangan_code" value="{$info.dangan_code}" name="dangan_code" class="check_inp" placeholder=" 输入备案档案编号" />
										</label>
									</div>
								</div>
							</div>
							<div class="equip_list engin_boxt clearfix row">
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>备案审核结果：</span>
											 <select id="beian_status" name="beian_status" class="organ-info cenz check_inp check_inps" >
			                                    <option value="">请选择备案审核结果</option>
			                                    <option <?php if($info['beian_status']==1): ?>selected="selected"<?php endif; ?> value="1">通过审核</option>
			                                    <option <?php if($info['beian_status']==2): ?>selected="selected"<?php endif; ?> value="2">未通过审核</option>
			                                </select>
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man engin_span"><i class="required_fields">*</i>备案日期：</span>
											<input id="beian_date" onclick="laydate()" value="{$info.beian_date}" name="beian_date"  placeholder='请选择备案日期' value="" class="fl check_inp  picker-date">
										</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="cheitm">
										<label class="ifro_item id_relative" style="margin-top:14px ;">
											<span class="info_man engin_span" style="line-height: 26px;">附件：</span>
											<input type="file" id="file" name="file" class="up_file up_files" title="文件不大于5M" />
											<!--<span class="idcardupload">选择文件</span>-->
										</label>
									</div>
								</div>
							</div>
						</div>
						</div>
				
				<!--完成-->
				<div class="add_finish equip_finish">
					<a href="javascript:0" id="save" class="opass equipfinish engin_finish">保存</a>
					<a onclick="javascript:history.go(-1);" class="opass equipfinish engin_finish_exit">取消</a>
				</div>
			</div><!--equip_infomation-->
				</form>
		</div>
	</div>		
<!--content-->

<script src="__PUBLIC__/assets/js/laydate/laydate.js"></script>
<script>

	$(document).on('click','#save',function(){
		var chanquan = $('#chanquan').val();
		var jishu = $('#jishu').val();
		var jishu_mobile = $('#jishu_mobile').val();
		var guanli = $('#guanli').val();
		var guanli_mobile = $('#guanli_mobile').val();
		var fac_id = $('#fac_id').val();
		var address = $('#address').val();
		var laiyuan = $('#laiyuan').val();
		var beian_code = $('#beian_code').val();
		var dangan_code = $('#dangan_code').val();
		var beian_status = $('#beian_status').val();
		var beian_date = $('#beian_date').val();
		var file = $('#file').val();

		if(chanquan==''){
			layer.msg('产权单位不能为空', {time: 1500});
			return false;
		}

		if(jishu==''){
			layer.msg('技术负责人不能为空', {time: 1500});
			return false;
		}

		if(jishu_mobile==''){
			layer.msg('联系电话不能为空', {time: 1500});
			return false;
		}

		var pattern = /^1[34578]\d{9}$/;

		if(pattern.test(jishu_mobile)==false){
			layer.msg('联系人手机号码格式不正确', {time: 1500});
			return false;
		}

		if(guanli==''){
			layer.msg('设备管理负责人不能为空', {time: 1500});
			return false;
		}

		if(guanli_mobile==''){
			layer.msg('联系电话不能为空', {time: 1500});
			return false;
		}

		if(pattern.test(guanli_mobile)==false){
			layer.msg('联系人手机号码格式不正确', {time: 1500});
			return false;
		}

		if(fac_id==''){
			layer.msg('设备编号不能为空', {time: 1500});
			return false;
		}

		if(address==''){
			layer.msg('安装/存放地址不能为空', {time: 1500});
			return false;
		}

		if(laiyuan==''){
			layer.msg('设备来源不能为空', {time: 1500});
			return false;
		}

		if(beian_code==''){
			layer.msg('产权备案编号不能为空', {time: 1500});
			return false;
		}

		if(dangan_code==''){
			layer.msg('备案档案编号不能为空', {time: 1500});
			return false;
		}

		if(beian_status==''){
			layer.msg('备案审核结果不能为空', {time: 1500});
			return false;
		}

		if(beian_date==''){
			layer.msg('备案日期不能为空', {time: 1500});
			return false;
		}
		layer.load(1, {
			shade: [0.1,'#fff'] //0.1透明度的白色背景
		});

		$('#form1').ajaxSubmit({
			dataType:'json',
			success:function(res){
				layer.closeAll();
				if(res.status !=1){
					layer.msg(res.msg, {time: 1500});
					return false;
				}else{

					layer.closeAll();
					layer.msg(res.msg, {time: 1500},function(){
						javascript:history.go(-1);
					});

				}
			}
		});

	})


	$(document).on('change','#chanquan',function(){

		var id = $(this).val();
		if(id==''){
			return false;
		}

		layer.load(1, {
			shade: [0.1,'#fff'] //0.1透明度的白色背景
		});

		$.ajax({
			url:"{:U('Admin/File/')}"+'/'+"{:ACTION_NAME}",
			dataType:'json',
			type:'post',
			data:{
				'do':'get_company',
				'id':id
			},
			success:function(e){
				layer.closeAll();
				if(e.status!=1){
					layer.msg('获取产权单位信息失败，请重试', {time: 1500});
					return false;
				}

				$('#license_code').text(e.data.license_code);
				$('#diqu1').text(e.data.diqu);
				$('#diqu2').text(e.data.diqu);
				$('#faren').text(e.data.faren);
				$('#faren_mobile').text(e.data.faren_mobile);

				return false;

			}
		})
	})

	$(document).on('change','#fac_id',function(){
		var id = $(this).val();
		if(id==''){
			return false;
		}

		layer.load(1, {
			shade: [0.1,'#fff'] //0.1透明度的白色背景
		});

		$.ajax({
			url:"{:U('Admin/File/')}"+'/'+"{:ACTION_NAME}",
			dataType:'json',
			type:'post',
			data:{
				'do':'get_fac',
				'id':id
			},
			success:function(e){
				layer.closeAll();
				if(e.status!=1){
					layer.msg('获取设备信息失败，请重试', {time: 1500});
					return false;
				}

				var param = e.param;
				console.log(param);
				var html = '';
//				var i =0;
				if(param!=null){
					$.each(param, function (n, value) {
						var num = n+1;
						html+=	'<tr>'+
								'<td>'+num+'</td>'+
								'<td></td>'+
								'<td>'+ value.type +'</td>'+
								'<td>'+ value.name +'</td>'+
								'<td>'+ value.value +'</td>'+
								'<td>'+ value.mark +'</td>'+
								'</tr>';
					});
				}



				$('#type').text(e.data.facility_type);
				$('#xinghao').text(e.data.facility_model_number);
				$('#chuchang').text(e.data.factory_date);
				$('#xuke').text(e.data.manufacturing_licence_number);
				$('#make_company').text(e.data.make_company);
				$('#position').html(html);
				return false;

			}
		})
	})

	window.onload=function(){

		$('.chosen-single').css('background-color','rgba(51,51,51,0.1)');
		$('.chosen-container-single').css('margin-left','13px');
	}
</script>
<include file="Public:footer"/>