<script language="javascript" type="text/javascript" src="__PUBLIC__/assets/date/WdatePicker.js"></script>
<div class="panel panel-inverse" data-sortable-id="form-stuff-1">
    <div class="panel-body">
        <form class="form-horizontal" method='post' action='{:U("File/".ACTION_NAME)}' enctype="multipart/form-data">
            <input type='hidden' name='do' value="save"/>

            <input type='hidden' name='fid' value='{$info.id}'/>
            <div class="form-group">
                <label class="col-md-3 control-label">审核</label>
                <div class="col-lg-5">
                    <input type="radio" id="shenhe" name='status' value='1' <if condition="$info['status'] eq '1'">checked</if>/>审核成功
                    <input type="radio" id="shibai"  name='status' value='2' <if condition="$info['status'] eq '2'">checked</if>/>审核失败
                </div>
            </div>
                <div class="form-group" id="cause">
                    <label class="col-md-3 control-label">失败原因</label>
                    <div class="col-lg-5">
                        <textarea class="form-control" name="cause">{$info.cause}</textarea>
                    </div>
                </div>
            <div class="form-group">
                <div class="col-sm-offset-3 col-sm-2">
                    <btn onclick="layer.closeAll()" class='btn btn-sm btn-default m-r-5 btn-block'>返 回</btn>
                </div>
                <div class="col-sm-2">

                    <button type="submit" class="btn btn-sm btn-danger btn-block">提 交</button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- end panel -->
<script type='text/javascript'>
    $(function(){
        var vi = $("input[name='status']:checked").val();
        if(vi == 1){
            $('#cause').hide();
        }
        $('#shenhe').click(function(){
            $('#cause').hide();
        })
        $('#shibai').click(function(){
            $('#cause').show();
        })
    })
    var addPage = {
        init:function(){
            this.bind();
        },
        bind:function(){
            var _this = this;
            $(document).on('click','#chose',function(){
                var that = $(this);
                $('.layui-layer-iframe,.layui-layer-shade').remove();
                _this.openLayer(that.text(),"{:U('Auth/add',array('do'=>'choice_icon'))}",'','');

                return false;
            })
            $('form').validator({
                theme:'yellow_top',
                msgClass:'n-right',
                msgIcon:'',
                msgMaker: function(opt){
                    if(!opt.msg){
                        return '';
                    }
                    return '<span class="msg-wrap n-error" role="alert"><span class="n-msg">'+opt.msg+'</span></span>'
                },
                fields: {
                    'facilityid': "设备编号:required;",
                    'data_number': "资料编号:required;",
                    'data_name': "资料名称:required;",
                    'data_typeid': "资料类型:required;"
                },
                valid: function(form){
                    var loading = layer.load(1, {
                        shade: [0.1,'#fff'] //0.1透明度的白色背景
                    });
                    $(form).ajaxSubmit({
                        dataType:'json',
                        success:function(res){
                            layer.close(loading);
                            if(res.status !=1){
                                var confirm_alert = layer.confirm(res.msg, {
                                    btn: ['确定'], //按钮
                                    closeBtn:0
                                }, function() {
                                    layer.close(confirm_alert);

                                });
                            } else {
                                layer.closeAll();
                                Page.renderTable();
                            }
                        }
                    });
                }
            });
        },
        openLayer: function(title,url,width,height){
            if(width == ''){
                width = '1200px';
            }
            if(height == ''){
                height = '650px';
            }
            layer.open({
                type: 2,
                title: title,
                area: [width, height], //宽高
                closeBtn: 1, //不显示关闭按钮
                shift: 2,
                shadeClose: true, //开启遮罩关闭
                content: url
            });
        },
    }
    $(function(){
        addPage.init();
    })
</script>