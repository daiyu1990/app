<script language="javascript" type="text/javascript" src="__PUBLIC__/assets/date/WdatePicker.js"></script>
<div class="panel panel-inverse" data-sortable-id="form-stuff-1">
    <div class="panel-body">
        <form class="form-horizontal" method='post' action='{:U("File/".ACTION_NAME)}' enctype="multipart/form-data">
            <input type='hidden' name='do' value="save"/>
            <if condition="ACTION_NAME eq 'edit'">
                <input type='hidden' name='id' value='{$info.id}'/>
            </if>
            <div class="form-group">
                <label class="col-md-3 control-label">设备编号</label>
                <div class="col-lg-5">
                    <select class="form-control" name="facilityid">
                        <volist name="data" id="vo">
                            <if condition="$info['facilityid'] eq $vo['mid']">
                                <option value="{$vo.mid}" selected>{$vo.facility_number}</option>
                                <else/>
                                <option value="{$vo.mid}">{$vo.facility_number}</option>
                            </if>
                        </volist>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-3 control-label">资料编号</label>
                <div class="col-lg-5">
                    <input type="text" class="form-control" name='data_number' value='{$info.data_number}' placeholder="资料编号" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-3 control-label">资料名称</label>
                <div class="col-lg-5">
                    <input type="text" class="form-control" name='data_name' value='{$info.data_name}' placeholder="资料名称" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-3 control-label">资料类型</label>
                <div class="col-lg-5">
                    <select class="form-control" name="data_typeid">
                        <volist name="type" id="vo">
                            <if condition="$info['data_typeid'] eq $vo['id']">
                                <option value="{$vo.id}" selected>{$vo.name}</option>
                                <else/>
                                <option value="{$vo.id}">{$vo.name}</option>
                            </if>
                        </volist>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-3 control-label">添加附件</label>
                <div class="col-lg-5">
                    <input type="file" name="file_path"/>
                    <if condition="$info['file_path'] eq true">
                        　原附件：<img src="__ROOT__{$info.file_path}" style="width: 100px;height: 50px;"/>
                    </if>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-3 col-sm-2">
                    <btn onclick="layer.closeAll()" class='btn btn-sm btn-default m-r-5 btn-block'>返 回</btn>
                </div>
                <div class="col-sm-2">

                    <button type="submit" class="btn btn-sm btn-danger btn-block">提 交</button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- end panel -->
<script type='text/javascript'>
    var addPage = {
        init:function(){
            this.bind();
        },
        bind:function(){
            var _this = this;
            $(document).on('click','#chose',function(){
                var that = $(this);
                $('.layui-layer-iframe,.layui-layer-shade').remove();
                _this.openLayer(that.text(),"{:U('Auth/add',array('do'=>'choice_icon'))}",'','');

                return false;
            })
            $('form').validator({
                theme:'yellow_top',
                msgClass:'n-right',
                msgIcon:'',
                msgMaker: function(opt){
                    if(!opt.msg){
                        return '';
                    }
                    return '<span class="msg-wrap n-error" role="alert"><span class="n-msg">'+opt.msg+'</span></span>'
                },
                fields: {
                    'facilityid': "设备编号:required;",
                    'data_number': "资料编号:required;",
                    'data_name': "资料名称:required;",
                    'data_typeid': "资料类型:required;"
                },
                valid: function(form){
                    var loading = layer.load(1, {
                        shade: [0.1,'#fff'] //0.1透明度的白色背景
                    });
                    $(form).ajaxSubmit({
                        dataType:'json',
                        success:function(res){
                            layer.close(loading);
                            if(res.status !=1){
                                var confirm_alert = layer.confirm(res.msg, {
                                    btn: ['确定'], //按钮
                                    closeBtn:0
                                }, function() {
                                    layer.close(confirm_alert);

                                });
                            } else {
                                layer.closeAll();
                                Page.renderTable();
                            }
                        }
                    });
                }
            });
        },
        openLayer: function(title,url,width,height){
            if(width == ''){
                width = '1200px';
            }
            if(height == ''){
                height = '650px';
            }
            layer.open({
                type: 2,
                title: title,
                area: [width, height], //宽高
                closeBtn: 1, //不显示关闭按钮
                shift: 2,
                shadeClose: true, //开启遮罩关闭
                content: url
            });
        },
    }
    $(function(){
        addPage.init();
    })
</script>