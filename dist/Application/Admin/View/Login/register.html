<!DOCTYPE html>
<html lang="en">
<style>
	.get_code_btn {
		display: inline-block;
		height: 38px;
		line-height: 38px;
		border: none;
		color: #3a3a3a;
		-webkit-border-radius: 3px;
		-moz-border-radius: 3px;
		border-radius: 3px;
		font-size: 12px;
		width: 96px;
		cursor: pointer;
		background: #f1f1f1;
		box-shadow: rgba(168,168,168,0.8) 2px 2px 2px;
	}

	#check_person {
		height: 36px;
		width: 300px;
		-webkit-border-radius: 36px;
		-moz-border-radius: 36px;
		border-radius: 36px;
		display: block;
		color: #fff;
		text-align: center;
		margin: 10px auto 0;
	/* margin-top: 10px; */
	/* background: #3a84ff; */
		background: #2164ff;
		padding-left: 0;
		font-size: 16px;
	}

	#code {
		width: 170px;
		float: left;
	}
</style>
<head>
    <meta charset="utf-8">
    <title>注册页面</title>
    <link rel="stylesheet" href="__PUBLIC__/assets/css/login/reset.css">
    <link rel="stylesheet" href="__PUBLIC__/assets/css/login/common.css">
</head>
<body>
<div class="login_back">
    <div class="middle_content_block">
        <div class="content">
            <div class="title">
                <h1>飞达建筑起重机械</h1>
                <span>安全监管物联网平台</span>
            </div>
            <div class="register_content">
                <div class="title_register row">
                    <div class="register_user register_active register_item col-md-6">个人注册</div>
                    <div class="register_firm register_item col-md-6">企业注册</div>
                </div>
                <!--个人注册-->
                <div class="register_itemos register_show">
	                    <input type="hidden" name="do" value="check" >
	                    <div class="process_img process_img_man">
	                        <!--<div class="process_item process_man_info">
	                            <img src="/Public/assets/images/login/forget_view1.png" alt="">
	                            <span>填写手机号</span>
	                        </div>
	                        <b></b>-->
	                        <div class="process_item process_man_info">
	                            <img src="/Public/assets/images/login/forget_view1.png" alt="">
	                             <span>完善信息</span>
	                        </div>
	                        <b style="width:128px ;"></b>
	                        <div class="process_item">
	                            <img src="/Public/assets/images/login/forget3.png" alt="">
	                             <span>注册完成</span>
	                        </div>
	                    </div>
	                    <div class="login_block">
	                    	<div class="register_man_info" style="block;">
		                        <label for="person_phone">
		                            <b class="person_phone"></b> <input  type="text" name="mobile" id="person_phone" placeholder="请输入手机号获取验证码">
		                        </label>
		                        <div class="center_code_container">
		                            <b class="code_icon"></b>
		                            <input type="text" id="phone_code" name="code" placeholder="请输入验证码">
		                            <div class="phone_code_set">
		                                <button class="get_code_btn" id="get_code" style="background:#2164ff !important ; color: #fff;">获取验证码</button>
		                            </div>
		                        </div>
		                        <label for="person_phone">
		                            <b class="person_phone"></b> <input  type="password" name="password" id="person_pwd1" placeholder="请输入密码">
		                            <!--<p class="check_warn"><img src="/Public/assets/images/login/warn_icon.png" alt=""> <span>号码输入有误,请重新输入</span></p>-->
		                        </label>
		                        <label for="person_phone">
		                            <b class="person_phone"></b> <input  type="password" name="password_confirm" id="person_pwd2" placeholder="确认密码">
		                            <!--<p class="check_warn"><img src="/Public/assets/images/login/warn_icon.png" alt=""> <span>号码输入有误,请重新输入</span></p>-->
		                        </label>
		                        <input id="check_person" class="forget_check_man"   type="submit" value="下一步">
	                        </div>
	                        <!--注册成功-->	
                        	<div class="register_man_success" style="display: none;">
                        		<img src="/Public/assets/images/login/3.1.png" alt="">
                            	<p>恭喜您 ！</p>
                            	<p>新个人用户注册成功 ！</p>
                        	</div>
	                        <p class="miss_pass"><!--<a href="index.html">立即登录</a>--></p>
	                    </div>
                </div>
                <!--企业注册-->
                <div class="register_itemos">
	                    <input type="hidden" name="do" value="check" >
	                    <div class="process_img process_img_firm">
	                        <div class="process_item process_item_tel">
	                            <img src="/Public/assets/images/login/forget_view1.png" alt="">
	                            <span>填写手机号</span>
	                        </div>
	                        <b></b>
	                        <div class="process_item process_item_info">
	                            <img src="/Public/assets/images/login/forget2.png" alt="">
	                            <span>完善信息</span>
	                        </div>
	                        <b></b>
	                        <div class="process_item">
	                            <img src="/Public/assets/images/login/forget3.png" alt="">
	                             <span>注册完成</span>
	                        </div>
	                    </div>
	                    <div class="login_block">
	                    	<div class="register_firm_con">
	                    		<!--填写手机号-->
	                    		<div class="register_firm_items register_firm_tel" style="display: block;">
			                        <label for="person_phone">
			                            <b class="person_phone"></b> <input  type="text" name="mobile" id="company_phone" placeholder="请输入手机号获取验证码">
			                            <!--<p class="check_warn"><img src="/Public/assets/images/login/warn_icon.png" alt=""> <span>号码输入有误,请重新输入</span></p>-->
			                        </label>
			                        <!--<div class="center_code_container">-->
			                            <!--<b class="code_icon"></b>-->
			                            <!--<input type="text" id="phone_code" name="code" placeholder="请输入图形验证码">-->
			                            <!--<div class="phone_code_set">-->
			                                <!--<button id="phone_give_pass" style="background:#2164ff !important ; color: #fff;">获取图形验证码</button>-->
			                            <!--</div>-->
			                        <!--</div>-->
			                        <div class="center_code_container">
			                            <b class="code_icon"></b>
			                            <input type="text" id="code" name="code" placeholder="请输入验证码">
			                            <div class="phone_code_set">
			                                <button id="phone_give_pass" class="get_code_btn" style="background:#2164ff !important ; color: #fff;">获取验证码</button>
			                            </div>
			                        </div>
			                        <input id="forget_check" class="forget_check_firm"  type="submit" value="下一步">
	                        	</div>
	                       		<!--完善信息-->	
	                        	<div class="register_firm_items register_firm_info" style="display: none;">
					                    <input type="hidden"  value="reg"/>
					                    <div class="register_all_put">
					                    	<label>
					                            <b class="register_company"></b>
					                            <input id="company" type="text" placeholder="单位名称" >
					
					                        </label>	
					                    	<label>
					                    		<b class="register_class"></b>
												<input id="company_code"  type="text" placeholder="组织机构代码" >


											</label>
					                        <label>
					                            <b class="register_password"></b>
					                            <input type="password" placeholder="请输入6位以上字符密码" id="pwd1">
					                        </label>
					                        <label>
					                            <b class="register_password"></b>
					                            <input type="password" placeholder="再次输入密码"   id="pwd2">
					                        </label>
					
					                        <label>
					                            <b class="register_username"></b>
					                            <input type="text" placeholder="联系人姓名"  id="company_contact">
					                        </label>
					
					                        <div class="register_container">
					                            <b class="register_email"></b>
					                            <input type="text" id="email" placeholder="请输入邮箱">
					                            
					                        </div>
					
					                    </div>
					                    <label class="user_agree">
					                    	<input type="checkbox" class="fl agree_box" />
					                    	<span class="fl">阅读并接受用户协议</span>
					                    </label>
					                    <input id="register_submit" type="submit"  value="确定">
	                        	</div>
                        		<!--注册成功-->	
	                        	<div class="register_firm_items register_firm_success" style="display: none;">
	                        		<img src="/Public/assets/images/login/3.1.png" alt="">
	                            	<p>恭喜您 ！</p>
	                            	<p>新企业用户注册成功 ！</p>
	                        	</div>
                        	</div>
	                        <p class="miss_pass"><!--<a href="index.html">立即登录</a>--></p>
	                    </div>
                </div>
                <p class="bottom_register">
                    已有账户 <a href="__URL__/index">立即登录</a>
                </p>
            </div>
        </div>
    </div>
</div>
<script src="__PUBLIC__/assets/js/jquery-2.1.1.js"></script>
<js file="__PUBLIC__/assets/js/layer/layer.js"/>

<script>
	//整体注册切换
	
	$(document).on('click','.register_item',function(){
		$(this).addClass('register_active').siblings().removeClass('register_active');
		$('.register_content .register_itemos').eq($(this).index()).addClass('register_show').siblings().removeClass('register_show');
		
	})

	$(document).on('click','#register_submit',function(){
		var company = $('#company').val();
		var company_code = $('#company_code').val();
		var pwd1 = $('#pwd1').val();
		var pwd2 = $('#pwd2').val();
		var name = $('#company_contact').val();
		var email = $('#email').val();

		if(company == ''){
			layer.msg('单位名称不能为空', {time: 2000});
			return false;
		}

		if(company_code == ''){
			layer.msg('组织结构代码不能为空', {time: 2000});
			return false;
		}

		if(pwd1 == ''){
			layer.msg('密码不能为空', {time: 2000});
			return false;
		}

		if(pwd1.length<6 && pwd1.length>16){
			layer.msg('密码长度至少为6位,最多16位', {time: 2000});
			return false;
		}

		if(pwd2 == ''){
			layer.msg('确认密码不能为空', {time: 2000});
			return false;
		}

		if(pwd2 != pwd1){
			layer.msg('两次密码输入不一致', {time: 2000});
			return false;
		}

		if(name == ''){
			layer.msg('联系人姓名不能为空', {time: 2000});
			return false;
		}

		if(email == ''){
			layer.msg('邮箱不能为空', {time: 2000});
			return false;
		}

		var res = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
		if(res.test(email) == false){
			layer.msg('邮箱格式不正确', {time: 2000});
			return false;
		}

		layer.load(1, {
			shade: [0.1,'#000'] //0.1透明度的白色背景
		});

		$.ajax({
			url:"{:U('Admin/Login/register')}",
			dataType:'json',
			type:'post',
			data:{
				'do':'reg',
				'company' :company,
				'code' :company_code,
				'pwd1' :pwd1,
				'pwd2' :pwd2,
				'name' :name,
				'email' :email

			},
			success:function(res){
				layer.closeAll();
				if(res.status !=1){
					layer.msg(res.msg, {time: 2000});

				} else {
					$('.register_firm_tel').hide();
					$('.register_firm_info').hide();
					$('.process_img_firm').hide();
					$('.register_firm_success').show();
				}
			}
		});

		return false;


	})

	//企业注册切换
	$(document).on('click','.forget_check_firm',function(){

		var phone = $('#company_phone').val();
		var code = $('#code').val();

		if(phone == ''){
			layer.msg('手机号不能为空', {time: 2000});
			return false;
		}

		var pattern = /^1[34578]\d{9}$/;

		if(pattern.test(phone)==false){
			layer.msg('手机号码格式不正确', {time: 1500});
			return false;
		}

		if(code == ''){
			layer.msg('验证码不能为空', {time: 2000});
			return false;
		}


		layer.load(1, {
			shade: [0.1,'#000'] //0.1透明度的白色背景
		});

		$.ajax({
			url:"{:U('Admin/Login/register')}",
			dataType:'json',
			type:'post',
			data:{
				do:'check',
				mobile :phone,
				code :code,

			},
			success:function(res){
				layer.closeAll();
				if(res.status !=1){
					layer.msg(res.msg, {time: 2000});

				} else {
					$('.register_firm_tel').hide();
					$('.register_firm_info').show();
					$('.process_item_info').children('img').attr('src','/Public/assets/images/login/forget_view2.png');
					$('.process_item_info').children('span').css('color','#2164ff');
					$('.process_item_tel').children('img').attr('src','/Public/assets/images/login/forget1.png');
				}
			}
		});



		return false;

	})



	//获取验证码


	//个人注册切换
	$(document).on('click','#check_person',function(){

		var phone = $('#person_phone').val();
		var code = $('#phone_code').val();
		var pwd1 = $('#person_pwd1').val();
		var pwd2 = $('#person_pwd2').val();

		if(phone == ''){
			layer.msg('手机号不能为空', {time: 2000});
			return false;
		}

		var pattern = /^1[34578]\d{9}$/;

		if(pattern.test(phone)==false){
			layer.msg('手机号码格式不正确', {time: 1500});
			return false;
		}

		if(code == ''){
			layer.msg('验证码不能为空', {time: 2000});
			return false;
		}

		if(pwd1 == ''){
			layer.msg('密码不能为空', {time: 2000});
			return false;
		}

		if(pwd1.length < 6 || pwd1.length >16){
			layer.msg('密码长度至少为6位,最多16位', {time: 2000});
			return false;
		}

		if(pwd2 == ''){
			layer.msg('确认密码不能为空', {time: 2000});
			return false;
		}

		if(pwd1 != pwd2){
			layer.msg('两次密码输入不一致', {time: 2000});
			return false;
		}

		layer.load(1, {
			shade: [0.1,'#000'] //0.1透明度的白色背景
		});

		$.ajax({
			url:"{:U('Admin/Login/register')}",
			dataType:'json',
			type:'post',
			data:{
				do:'check',
				mobile :phone,
				code :code,
				pwd1 :pwd1,
				pwd2 :pwd2,
			},
			success:function(res){
				layer.closeAll();
				if(res.status !=1){
					layer.msg(res.msg, {time: 2000});

				} else {
					$('.register_man_info').hide();
					$('.process_img_man').hide()
					$('.register_man_success').show();
				}
			}
		});



		return false;
	})

	//    获取验证码动画
	var giveCheckCode1={
		num:60,
		timeSet:'',
		init:function(){
			var _this=this;
			$(document).on('click','#phone_give_pass',function(e){
				var phone = $('#company_phone').val();

				if(phone==''){
					layer.msg('请填写手机号', {time: 1500});
					return false;
				}
				var pattern = /^1[34578]\d{9}$/;

				if(pattern.test(phone)==false){
					layer.msg('手机号码格式不正确', {time: 1500});
					return false;
				}

				layer.load(1, {
					shade: [0.1,'#000'] //0.1透明度的白色背景
				});

				e.preventDefault();
				$(this).addClass('phone_give_pass_move');
				_this.resetMove(this);

				$.ajax({
					url:"{:U('Admin/Login/register')}",
					dataType:'json',
					type:'post',
					data:{
						do:'send',
						mobile :phone
					},
					success:function(res){
						if(res.status !=1){
							layer.closeAll();
							layer.confirm(res.msg, {
								btn: ['确定'], //按钮
								closeBtn:0
							}, function() {
								layer.closeAll();
//                                // $('#username,#password,#verify').val('')
//                                window.location.reload();
							});
						} else {
							layer.closeAll();
							_this.waitTime();
							$(this).prop('disabled',true);
						}
					}
				});


			})
		},
		resetMove:function(now){
			setTimeout(function(){
				$(now).removeClass('phone_give_pass_move');
			},600);
		},
		waitTime:function(){
			this.timeSet=setInterval(function(){
				this.num--;
				$('#phone_give_pass').html('('+this.num+'s)重新发送')
				if(this.num<=0){
					clearInterval(this.timeSet);
					$('#phone_give_pass').html('获取验证码');
					$('#phone_give_pass').prop('disabled',false);
					this.num=60;
				}
			}.bind(this),1000);
		}
	}



	//    获取验证码动画
	var giveCheckCode={
		num:60,
		timeSet:'',
		init:function(){
			var _this=this;
			$(document).on('click','#get_code',function(e){
				var phone = $('#person_phone').val();

				if(phone==''){
					layer.msg('请填写手机号', {time: 1500});
					return false;
				}
				var pattern = /^1[34578]\d{9}$/;

				if(pattern.test(phone)==false){
					layer.msg('手机号码格式不正确', {time: 1500});
					return false;
				}

				layer.load(1, {
					shade: [0.1,'#000'] //0.1透明度的白色背景
				});

				e.preventDefault();
				$(this).addClass('phone_give_pass_move');
				_this.resetMove(this);

				$.ajax({
					url:"{:U('Admin/Login/register')}",
					dataType:'json',
					type:'post',
					data:{
						do:'send',
						mobile :phone
					},
					success:function(res){
						if(res.status !=1){
							layer.closeAll();
							layer.confirm(res.msg, {
								btn: ['确定'], //按钮
								closeBtn:0
							}, function() {
								layer.closeAll();
//                                // $('#username,#password,#verify').val('')
//                                window.location.reload();
							});
						} else {
							layer.closeAll();
							_this.waitTime();
							$(this).prop('disabled',true);
						}
					}
				});


			})
		},
		resetMove:function(now){
			setTimeout(function(){
				$(now).removeClass('phone_give_pass_move');
			},600);
		},
		waitTime:function(){
			this.timeSet=setInterval(function(){
				this.num--;
				$('#get_code').html('('+this.num+'s)重新发送')
				if(this.num<=0){
					clearInterval(this.timeSet);
					$('#get_code').html('获取验证码');
					$('#get_code').prop('disabled',false);
					this.num=60;
				}
			}.bind(this),1000);
		}
	}

	window.onload=function(){
		$('body').addClass('set_come');
		giveCheckCode.init();
		giveCheckCode1.init();

		//$('body').css('height',$(window).height());
	}
</script>
</body>
</html>