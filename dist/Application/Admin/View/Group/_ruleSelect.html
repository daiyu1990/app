<script type="text/javascript" src="__PUBLIC__/assets/js/ztree/js/jquery.ztree.core.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/assets/js/ztree/js/jquery.ztree.excheck.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/assets/js/ztree/css/zTreeStyle/zTreeStyle.css">
<input type='hidden' name='rules' value='{$info.rules}' id='location'/>
<div id="modal-content" class="row mt10 table-layout table-clear-xs">
    <div class="col-xs-12 col-sm-12 br-a br-light bg-light p10">
        <h5 class="text-muted mtn">选择权限</h5>
        <ul id="treeBox" class="ztree"></ul>
    </div>
</div>
<script type="text/javascript">
function onCheck(e,treeId,treeNode){
    var treeObj = $.fn.zTree.getZTreeObj("treeBox"),
        nodes = treeObj.getCheckedNodes(true),
        v = "";
    for(var i=0;i<nodes.length;i++){
        v += (nodes[i].id + ",");
        // alert(nodes[i].id); 
    }
    // alert(v);
    $('#location').val(v);


}
$(document).ready(function(){
    var location = '{$info.rules}';
    var arr = new Array();
    arr = location.split(',');
        var setting = {
            check: {
                enable: true,
                chkStyle: "checkbox",  
                // chkboxType: { "Y": "p", "N": "ps" } 
            },
            view: {
                showIcon: false,
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback:{
                onCheck:onCheck
            }
        };
    var zNodes = {$menus};
    var checkedNodes = '';
    for (var i = zNodes.length - 1; i >= 0; i--) {
        var item = zNodes[i];
        <if condition="ACTION_NAME == 'add'">
        zNodes[i]['checked'] = true;
        checkedNodes += (item['id']+',');
        <else/>
        if($.inArray(item['id'], arr)>-1){
            zNodes[i]['checked'] = true;
        }
        </if>
    };
    if(checkedNodes.length>0){
        $('#location').val(checkedNodes);
    }
    zTreeObj = $.fn.zTree.init($("#treeBox"), setting, zNodes);
    $(document).on("click","#checkAllTrue,#checkAllFalse", function(){
        var that = $(this);
        var zTree = $.fn.zTree.getZTreeObj("treeBox"),
        type = that.attr('id');
        nodes = zTree.getSelectedNodes();
        if (type.indexOf("All")<0 && nodes.length == 0) {
            layer.alert("请先选择一个节点");
        }

        if (type == "checkAllTrue") {
            zTree.checkAllNodes(true);
        } else if (type == "checkAllFalse") {
            zTree.checkAllNodes(false);
        }
        var nodes = zTree.getCheckedNodes(true),
        v = "";
        for(var i=0;i<nodes.length;i++){
            v += (nodes[i].id + ",");
            // alert(nodes[i].id); 
        }
        // alert(v);
        // console.log(v);
        $('#location').val(v);
    });
});

</script>