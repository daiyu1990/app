<include file="Public:header"/>
<!-- begin #content -->
		<div id="content" class="content content_waring">	
			<h1 class="page-header page_warging">
			    	<a>人员管理 </a>》<a>人员列表</a>》<a>{$title}</a>
			    	<a onclick="javascript:history.go(-1);" class="organ_back">
			    		<i class="engin_back"></i>
    					<span class="engin_add_text">返回</span>
			    	</a>
			</h1>
			<!--总标题-->
			<div class="equip_head engin_head">
				{$title}
			</div>
			<!--基本信息-->
			<form name="form1" id="form1" method="post" enctype="multipart/form-data" action='{:U("Admin/Organization/".ACTION_NAME)}' >
			<input type="hidden" value="save" name="do" >
			<?php if(ACTION_NAME == 'person_edit'): ?>
			<input type="hidden" value="{$info.uid}" name="id" >
			<?php endif; ?>
			<div class="equip_info ">
				<div class="equip_title engin_title">
					<i class="equip_i"></i>
					<span>基本信息</span>
				</div>
				<div class="equip_infomation">
					<!--设备基本信息表格-->
						<div class="detail-body check_bd clearfix">
								<div class="check-infol">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>姓名：</span>
											<input id="name" name="name" value="{$info.nicename}" type="text" class="check_inp" />
										</label>
									</div>
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>手机号：</span>
											<input id="mobile" name="mobile" value="{$info.mobile}" type="text" class="check_inp" />
										</label>
									</div>
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>登录密码：</span>
											<input id="pwd1" type="password"  name="pwd1" class="check_inp" />
										</label>
									</div>
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>部门：</span>
											<select name="section" id="section" class="check_inp" >
												<option value="">请选择部门</option>
												<?php foreach($section as $k=>$v){ ?>
													<?php if($info['section'] == $v['id']): ?>
														<option value="{$v['id']}" >{$v['name']}</option>
													<?php else: ?>
														<option value="{$v['id']}" >{$v['name']}</option>
													<?php endif; ?>
												<?php } ?>
											</select>

										</label>
									</div>
									<!--<div class="cheitm">-->
										<!--<label class="ifro_item">-->
											<!--<span class="info_man">邮箱：</span>-->
											<!--<input id="email" type="text"  name="email" class="check_inp" />-->
										<!--</label>-->
									<!--</div>-->

									<div class="cheitm">
										<label class="ifro_item id_relative">
											<span class="info_man"><i class="required_fields">*</i>身份证正面：</span>
											<input type="file" name="IDcard_zheng" id="IDcard_zheng" class="up_file up_files" title="文件不大于5M" />
											<!--<span class="idcardupload">选择文件</span>-->
										</label>
									</div>
								</div>
								<div class="check-infol">
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>员工编号：</span>
											<input type="text" value="{$info.person_code}" name="person_code" id="person_code" class="check_inp" />
										</label>
									</div>
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>身份证号：</span>
											<input type="text" value="{$info.IDcard}" name="IDcard" id="IDcard" class="check_inp" />
										</label>
									</div>
									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>确认密码：</span>
											<input type="password" name="pwd2" id="pwd2" class="check_inp" />
										</label>
									</div>
									<!--<div class="cheitm">-->
										<!--<label class="ifro_item">-->
											<!--<span class="info_man">职位：</span>-->
											<!--<input type="text" value="{$info.duty}" name="zhiwei" id="zhiwei" class="check_inp" />-->
										<!--</label>-->
									<!--</div>-->

									<div class="cheitm">
										<label class="ifro_item">
											<span class="info_man"><i class="required_fields">*</i>职位：</span>
											<select name="zhiwei" id="zhiwei" class="check_inp" >
												<option value="">请选择职位</option>
												<?php foreach($group as $k=>$v){ ?>
												<?php if($info['group']['group_id'] == $v['id']): ?>
												<option value="{$v['id']}" selected="selected" >{$v['title']}</option>
												<?php else: ?>
												<option value="{$v['id']}" >{$v['title']}</option>
												<?php endif; ?>
												<?php } ?>
											</select>
										</label>
									</div>


									<div class="cheitm">
										<label class="ifro_item id_relative">
											<span class="info_man"><i class="required_fields">*</i>身份证反面：</span>
											<input type="file" name="IDcard_fan" id="IDcard_fan" class="up_file up_files" title="文件不大于5M" />
											<!--<span class="idcardupload">选择文件</span>-->
										</label>
									</div>
								</div>
							</div>	

				</div><!--equip_infomation-->
			</div><!--equip_info-->
			<!--关联信息-->
			<div class="equip_info">
				<div class="equip_title engin_title">
					<i class="equip_i"></i>
					<span>人员资质</span>
					<a class="organ-add">
						<i class="engin_add"></i>
						<span class="engin_add_text" id="new_builds">新建人员资质</span>
					</a>
				</div>



				<div class="equip_infomation">
					<div class="detail-body check_bd clearfix">
						<div class="table">
							<table class="layui-table fac_table" lay-skin="line">
								<thead>
								<tr>
									<th>序号</th>
									<th>证书编号</th>
									<th>证书名称</th>
									<th>资质等级</th>
									<th>证书到期日期</th>
									<th>证书正面</th>
									<th>证书反面</th>
									<th>删除</th>
								</tr>
								</thead>
								<tbody class="fac_tbody" id="zizhi">

								<?php foreach($info['zizhi'] as $k=>$v){ ?>
								<tr class="zizhi_tr">
									<td>{$k+1}</td>
									<td>
										<input type="text" name="a_code[]" value="{$v.code}" class="fac_edittr_input fac_edittr_inputs a_code" placeholder="输入证书编号"  />
										<input type="hidden" class="fac_edittr_input fac_edittr_inputs" name="a_id[]" value="{$v.id}"  />
									</td>
									<td>
										<input type="text" value="{$v.name}" name="a_name[]" class="fac_edittr_input fac_edittr_inputs a_name" placeholder="输入证书名称"  />
									</td>
									<td>
										<select name="a_level[]" class="fac_edittr_input fac_edittr_inputs organ-info cenz check_inp check_inps a_level" >
											<option value="">选择资质等级</option>
											<option <?php if($v['level']==1): ?>selected="selected"<?php endif; ?> value="1">初级</option>
											<option <?php if($v['level']==2): ?>selected="selected"<?php endif; ?> value="2">中级</option>
											<option <?php if($v['level']==3): ?>selected="selected"<?php endif; ?> value="3">高级</option>
										</select>
									</td>
									<td>
										<input onclick="laydate()" name="a_daoqi[]" value="{$v.daoqi}" placeholder="输入到期日期" value="" class="fac_edittr_input fac_edittr_inputs check_inp check_inp_date picker-date a_daoqi"></td>
									<td>
										<input name="a_zheng{$k+1}" type="file" style="width:80px;" class="check_inp check_upload a_zheng" />
										<span class="idcarduploadrg">更改文件</span>
									</td>
									<td>
										<input name="a_fan{$k+1}" type="file" style="width:80px;" class="check_inp check_upload a_fan" />
										<span class="idcarduploadrg">更改文件</span>
									</td>
									<td data="{$v.id}" class="del_edittim"><i class="del_edits" id=""></i></td>
								</tr>
								<?php } ?>

								</tbody>
							</table>
						</div>
					</div>

				</div>

						<!--完成-->
						<div class="add_finish equip_finish">
							<a id="save" class="opass equipfinish engin_finish">保存</a>
							<a onclick="javascript:history.go(-1);" class="opass equipfinish engin_finish_exit">取消</a>
						</div>


				</div><!--equip_infomation-->
			</form>
		</div><!--content-->	
<include file="Public:footer"/>
<script src="__PUBLIC__/assets/js/laydate/laydate.js"></script>
<script>

	$(document).on('click','#save',function(){
		var name = $('#name').val();
		var person_code = $('#person_code').val();
		var mobile = $('#mobile').val();
		var IDcard = $('#IDcard').val();
		var pwd1 = $('#pwd1').val();
		var pwd2 = $('#pwd2').val();
		var section = $('#section').val();
		var zhiwei = $('#zhiwei').val();
		var IDcard_zheng = $('#IDcard_zheng').val();
		var IDcard_fan = $('#IDcard_fan').val();

		if(name==''){
			layer.msg('姓名不能为空', {time: 1500});
			return false;
		}

		if(person_code==''){
			layer.msg('员工编号不能为空', {time: 1500});
			return false;
		}

		if(mobile==''){
			layer.msg('手机号不能为空', {time: 1500});
			return false;
		}

		var pattern = /^1[34578]\d{9}$/;

		if(pattern.test(mobile)==false){
			layer.msg('手机号码格式不正确', {time: 1500});
			return false;
		}

		if(IDcard==''){
			layer.msg('身份证号不能为空', {time: 1500});
			return false;
		}

		<?php if(ACTION_NAME=='person_add'): ?>
		if(pwd1==''){
			layer.msg('登录密码不能为空', {time: 1500});
			return false;
		}

		if(pwd2==''){
			layer.msg('确认密码不能为空', {time: 1500});
			return false;
		}
		<?php endif; ?>

		if(pwd1!=pwd2){
			layer.msg('两次密码输入不一致', {time: 1500});
			return false;
		}


		if(section==''){
			layer.msg('部门不能为空', {time: 1500});
			return false;
		}


		if(zhiwei==''){
			layer.msg('职位不能为空', {time: 1500});
			return false;
		}

		<?php if(ACTION_NAME=='person_add'): ?>
			if(IDcard_zheng==''){
				layer.msg('身份证正面不能为空', {time: 1500});
				return false;
			}

			if(IDcard_fan==''){
				layer.msg('身份证反面不能为空', {time: 1500});
				return false;
			}
		<?php endif; ?>

		var is_null = 0;
		$('.a_code').each(function(){

			if($(this).val()==''){
				is_null++;
			}
		})

		if(is_null>0){
			layer.msg('证书编号不能为空', {time: 1500});
			return false;
		}

		var is_null = 0;
		$('.a_name').each(function(){

			if($(this).val()==''){
				is_null++;
			}
		})

		if(is_null>0){
			layer.msg('证书名称不能为空', {time: 1500});
			return false;
		}

		var is_null = 0;
		$('.a_level').each(function(){

			if($(this).val()==''){
				is_null++;
			}
		})

		if(is_null>0){
			layer.msg('资质等级不能为空', {time: 1500});
			return false;
		}

		var is_null = 0;
		$('.a_daoqi').each(function(){

			if($(this).val()==''){
				is_null++;
			}
		})

		if(is_null>0){
			layer.msg('证书到期日期不能为空', {time: 1500});
			return false;
		}

		<?php if(ACTION_NAME=='person_add'): ?>
		var is_null = 0;
		$('.a_zheng').each(function(){

			if($(this).val()==''){
				is_null++;
			}
		})

		if(is_null>0){
			layer.msg('证书正面不能为空', {time: 1500});
			return false;
		}

		var is_null = 0;
		$('.a_fan').each(function(){

			if($(this).val()==''){
				is_null++;
			}
		})

		if(is_null>0){
			layer.msg('证书反面不能为空', {time: 1500});
			return false;
		}
		<?php endif; ?>

		$('#form1').submit();

	})


	$(function(){

		$(document).on('click','#new_builds',function(){

			var num = 1;
			$('.zizhi_tr').each(function(){
				num ++;
			})


			var html = $('#zizhi').html();
			html+=  '<tr class="zizhi_tr">'+
					'<td>'+num+'</td>'+
					'<td>'+
					'<input type="text" name="a_code[]" class="fac_edittr_input fac_edittr_inputs a_code" placeholder="输入证书编号"  />'+
					'<input type="hidden" class="fac_edittr_input fac_edittr_inputs" name="a_id[]" value=""  />'+
					'</td>'+
					'<td>'+
					'<input type="text" name="a_name[]" class="fac_edittr_input fac_edittr_inputs a_name" placeholder="输入证书名称"  />'+
					'</td>'+
					'<td>'+
					'<select name="a_level[]" class="fac_edittr_input fac_edittr_inputs organ-info cenz check_inp check_inps a_level" >'+
					'<option value="">选择资质等级</option>'+
					'<option value="1">初级</option>'+
					'<option value="2">中级</option>'+
					'<option value="3">高级</option>'+
					'</select>'+
					'</td>'+
					'<td>'+
					'<input onclick="laydate()" name="a_daoqi[]"  placeholder="输入到期日期" value="" class="fac_edittr_input fac_edittr_inputs check_inp check_inp_date picker-date a_daoqi"></td>'+
					'<td>'+
					'<input name="a_zheng'+num+'" type="file" style="width:80px;" class="check_inp check_upload a_zheng" />'+
					'<span class="idcarduploadrg">选择文件</span>'+
					'</td>'+
					'<td>'+
					'<input name="a_fan'+num+'" type="file" style="width:80px;" class="check_inp check_upload a_fan" />'+
					'<span class="idcarduploadrg">选择文件</span>'+
					'</td>'+
					'<td data="0" class="del_edittim"><i class="del_edits" id=""></i></td>'+
					'</tr>';

			$('#zizhi').html(html);
			return false;
		})

		$(document).on('click','.del_edittim',function(){
			var id=$(this).attr('data');
			if(id==0){
				$(this).parent().remove();
				return false;
			}else{
				layer.load(1, {
					shade: [0.1,'#fff'] //0.1透明度的白色背景
				});

				$.ajax({
					url:"{:U('Admin/Organization')}"+'/'+"{:ACTION_NAME}",
					dataType:'json',
					type:'post',
					data:{
						do:'del_apt',
						id:id
					},
					success:function(e){
						layer.closeAll();
						layer.msg(e.msg, {time: 2000});
						if(e.status!=1){
							return false;
						}

					}
				})
			}
			$(this).parent().remove();
		})


		$(document).on('click','#detail_del',function(){

			if($(this).attr('data')==''){
				$(this).parent('.detail-ftitem').remove();
			}else{
				var id = $(this).attr('data');
				layer.load(1, {
					shade: [0.1,'#fff'] //0.1透明度的白色背景
				});
				$.ajax({
					url:"{:U('Admin/Organization/person_edit')}",
					dataType:'json',
					type:'post',
					data:{
						'do':'del_cer',
						'id':id

					},
					success:function(e){
						layer.closeAll();
						$(this).parent('.detail-ftitem').remove();

						layer.msg(e.msg, {time: 1500});

					}
				})
			}

			return false;
		})
		$(document).on('click','#new_section',function(){

			var num = 1;
			$('.item_li').each(function(){
				num ++;
			})


//循环部门
			var html = '<div class="detail-ftitem detail_edit">'+
					'<div class="detail-log">证书'+num+'</div>'+
					'<i class="del_check" data="" id="detail_del"></i>'+
					'<ul class="check-infol item_li">'+
					'<li class="cheitm">'+
					'<label class="ifro_item">'+
					'<span class="info_man">证书编号：</span>'+
					'<input type="hidden" name="cer_id[]" value="" >'+
					'<input type="text" name="certificate_code[]" class="check_inp check_edit certificate_code" />'+
					'</label>'+
					'</li>'+
					'<li class="cheitm">'+
					'<label class="ifro_item">'+
					'<span class="info_man">证书名称：</span>'+
					'<input type="text" name="certificate_name[]" class="check_inp check_edit certificate_name" />'+
					'</label>'+
					'</li>'+
					'</ul>'+
					'</div>';

			$('.detailedit_add').before(html);

		})
	});
</script>